{"version":3,"file":"lib_index_js.0b907727467e25633749.js","mappings":"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","sources":["webpack://py-ssv/./src/index.ts","webpack://py-ssv/./src/version.ts","webpack://py-ssv/./src/widget.ts"],"sourcesContent":["/*\r\n * Copyright (c) 2023 Thomas Mathieson.\r\n * Distributed under the terms of the MIT license.\r\n */\r\n\r\nexport * from \"./version\";\r\nexport * from \"./widget\";\r\n","/*\r\n * Copyright (c) 2023 Thomas Mathieson.\r\n * Distributed under the terms of the MIT license.\r\n */\r\n\r\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n// @ts-ignore\r\n// eslint-disable-next-line @typescript-eslint/no-var-requires\r\nconst data = require(\"../package.json\");\r\n\r\n/**\r\n * The _model_module_version/_view_module_version this package implements.\r\n *\r\n * The html widget manager assumes that this is the same as the npm package\r\n * version number.\r\n */\r\nexport const MODULE_VERSION = data.version;\r\n\r\n/*\r\n * The current package name.\r\n */\r\nexport const MODULE_NAME = data.name;\r\n","/*\r\n * Copyright (c) 2023 Thomas Mathieson.\r\n * Distributed under the terms of the MIT license.\r\n */\r\n\r\nimport {\r\n  DOMWidgetModel,\r\n  DOMWidgetView,\r\n  ISerializers,\r\n  WidgetView\r\n} from \"@jupyter-widgets/base\";\r\n\r\nimport {MODULE_NAME, MODULE_VERSION} from \"./version\";\r\n\r\n// Import the CSS\r\nimport \"../css/widget.css\";\r\n\r\nenum StreamingMode {\r\n  PNG = \"png\",\r\n  JPG = \"jpg\",\r\n  H264 = \"h264\"\r\n}\r\n\r\nexport class SSVRenderModel extends DOMWidgetModel {\r\n  defaults() {\r\n    return {\r\n      ...super.defaults(),\r\n      _model_name: SSVRenderModel.model_name,\r\n      _model_module: SSVRenderModel.model_module,\r\n      _model_module_version: SSVRenderModel.model_module_version,\r\n      _view_name: SSVRenderModel.view_name,\r\n      _view_module: SSVRenderModel.view_module,\r\n      _view_module_version: SSVRenderModel.view_module_version,\r\n      streaming_mode: StreamingMode.PNG,\r\n      stream_data: \"ts\",\r\n      mouse_pos_x: 0,\r\n      mouse_pos_y: 0\r\n    };\r\n  }\r\n\r\n  static serializers: ISerializers = {\r\n    ...DOMWidgetModel.serializers\r\n    // Add any extra serializers here\r\n  };\r\n\r\n  static model_name = \"SSVRenderModel\";\r\n  static model_module = MODULE_NAME;\r\n  static model_module_version = MODULE_VERSION;\r\n  static view_name = \"SSVRenderView\"; // Set to null if no view\r\n  static view_module = MODULE_NAME; // Set to null if no view\r\n  static view_module_version = MODULE_VERSION;\r\n}\r\n\r\nexport class SSVRenderView extends DOMWidgetView {\r\n  private _stream_img_element: HTMLImageElement | null = null;\r\n\r\n  initialize(parameters: WidgetView.IInitializeParameters) {\r\n    super.initialize(parameters);\r\n  }\r\n\r\n  render() {\r\n    this.el.classList.add(\"ssv-render-widget\");\r\n\r\n    switch (this.model.get(\"streaming_mode\")) {\r\n      case StreamingMode.JPG:\r\n      case StreamingMode.PNG:\r\n        this._stream_img_element = document.createElement(\"img\");\r\n        this.el.appendChild(this._stream_img_element);\r\n        break;\r\n      default:\r\n        console.error(\r\n          `Unsupported streaming mode '${this.model.get(\"streaming_mode\")}'!`\r\n        );\r\n    }\r\n\r\n    this.stream_data_changed();\r\n    this.model.on(\"change:stream_data\", this.stream_data_changed, this);\r\n\r\n    if (this._stream_img_element) {\r\n      setInterval(() => {\r\n        this.send({\"heartbeat\": 0});\r\n      }, 500);\r\n\r\n      //let mousePos = { x: 0, y: 0 };\r\n      this._stream_img_element.addEventListener(\r\n        \"mousemove\",\r\n        (event: MouseEvent) => {\r\n          /*mousePos = {\r\n            x: event.clientX,// / target.width,\r\n            y: event.clientY,// / target.height\r\n          };*/\r\n\r\n          if (event?.target == null || !(event.target instanceof HTMLElement))\r\n            return;\r\n\r\n          const rect = event.target.getBoundingClientRect();\r\n          this.model.set(\"mouse_pos_x\", Math.round(event.clientX - rect.left));\r\n          this.model.set(\"mouse_pos_y\", Math.round(rect.height - (event.clientY - rect.top)));\r\n          this.model.save_changes();\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  stream_data_changed() {\r\n    if (!this._stream_img_element) return;\r\n\r\n    //this.el.textContent = this.model.get('stream_data');\r\n    this._stream_img_element.src = this.model.get(\"stream_data\");\r\n  }\r\n}\r\n"],"names":[],"sourceRoot":""}