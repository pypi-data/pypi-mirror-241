(()=>{"use strict";function*e(t,n=null){for(const r of t)yield[r,n],yield*e(r.children,r)}const t=["django_request","start_sql_query","outbound_http_request","start_test","django_template_start","background_job","django_setup_start","django_checks_start","django_create_test_db_start"],n=["django_response","end_sql_query","outbound_http_response","end_test","django_template_end","background_job_end","django_setup_end","django_checks_end","django_create_test_db_end"],r=["log_message"];function s(s){if(0===s.length)return{executionTreeNodes:[],totalExecutionTreeNodeCount:0,sql_queries:[],outbound_http_requests:[],background_jobs:[],log_messages:[]};const d=[],f=[];let p=0;const h={sql_queries:[],outbound_http_requests:[],background_jobs:[],log_messages:[]};let g,_=0,y=0,m=0;(s=u(s)).forEach((e=>{const u="event"in e&&"return"===e.event,l="event"in e&&"call"===e.event||e.type&&t.includes(e.type),b=u||e.type&&n.includes(e.type);if(l){if(0===f.length){const t=a(e,p);return f.push(t),void(p+=1)}{const t=f.length-1,n=f[t],r=a(e,p);return n.children.push(r),f.push(r),void(p+=1)}}if(b){if(0===f.length)return void console.log("Kolo warning: Throwing away return_frame with no corresponding_call frame"+JSON.stringify(e,null,2));const n=f.length-1,a=f[n],l=function(e){if("event"in e&&"return"===e.event)return"frame_span";if("event"in e&&"call"===e.event)throw new Error("Unexpected parent check for call frameOfInterest"+JSON.stringify(e,null,2));if(t.includes(e.type))throw new Error("Unexpected parent check for call-like frameOfInterest"+JSON.stringify(e,null,2));if(r.includes(e.type))throw new Error("Unexpected parent check for leaf frameOfInterest"+JSON.stringify(e,null,2));const n={django_response:"nested_served_http_request",end_sql_query:"sql_query",outbound_http_response:"outbound_http_request",end_test:"nested_test",django_template_end:"django_template",background_job_end:"nested_background_job",django_setup_end:"django_setup",django_checks_end:"django_checks",django_create_test_db_end:"django_create_test_db"};if(e.type in n)return n[e.type];throw new Error("Unexpected frameOfInterest when determining parent type: "+JSON.stringify(e,null,2))}(e);if(a.type!==l)!function(e,t,n){const r=c(e,t,n);throw new Error(`Could not build tree\nFrame with no corresponding return: ${e.frame_id} (${e.name})\n\n`+r+"\n\n")}(a,e,s);else{const t=a.frame_id,n=e.frame_id;if(t!==n){const r=c(a,e,s);console.log(`Kolo warning: frame_id mismatch. Expected ${t}, got ${n}\n`+r)}}if(u)a.data.return_frame=e;else if("django_response"===(null==e?void 0:e.type)){if(a.data.response=e,g){a.data.five_hundred_exception=g;const{annotatedChildren:e,exceptionFrameSpanIndex:t}=function(e,t){for(const[n,r]of t.exception_frames.entries()){const s=n===t.exception_frames.length-1;let o=e;for(const n of o){if("frame_span"!==n.type)continue;const{return_frame:a}=n.data;if(a.path===r.path&&a.co_name===r.co_name){if(s)return n.data.return_frame.exception=t,{annotatedChildren:e,exceptionFrameSpanIndex:n.index};a.exceptionMessage=i(t),o=n.children;break}}}return{annotatedChildren:e,exceptionFrameSpanIndex:void 0}}(a.children,g);a.children=e,a.data.five_hundred_exception_frame_span_index=t,g=void 0}}else if("end_sql_query"===(null==e?void 0:e.type))a.data.index=y,y+=1,a.name=o(e),a.data.query=e.query,a.data.query_template=e.query_template,a.data.query_data=e.query_data,a.data.database=e.database,a.data.return_timestamp=e.return_timestamp,h.sql_queries.push(a);else if("outbound_http_response"===(null==e?void 0:e.type)){a.data.index=_,_+=1,a.data.response={body:e.body,headers:e.headers,timestamp:e.timestamp,status_code:e.status_code};const t=f[n-1];"outbound_http_request"!==(null==t?void 0:t.type)&&h.outbound_http_requests.push(a)}else if("end_test"===(null==e?void 0:e.type))a.data.return_timestamp=e.timestamp;else if("django_template_end"===(null==e?void 0:e.type))a.data.return_timestamp=e.timestamp,a.data.return_context=e.context;else if("background_job_end"===(null==e?void 0:e.type))a.data.return_timestamp=e.timestamp,h.background_jobs.push(a);else if("django_setup_end"===(null==e?void 0:e.type))a.data.return_timestamp=e.timestamp;else if("django_checks_end"===(null==e?void 0:e.type))a.data.return_timestamp=e.timestamp;else{if("django_create_test_db_end"!==(null==e?void 0:e.type))throw new Error("Unexpected return-like frame of interest"+JSON.stringify(e,null,2));a.data.return_timestamp=e.timestamp}const p=f.pop();if(!p)throw new Error("currentTreeNode is unexpectedly falsy");0===f.length&&d.push(p)}else{if(e.type&&r.includes(e.type)){const t=f.length-1,n=f[t],r=a(e,p);return"log_message"===r.type&&(r.data.index=m,m+=1,h.log_messages.push(r)),t>=0?n.children.push(r):d.push(r),void(p+=1)}"exception"===e.type?g=e:"sql_query_data"===!e.type&&console.debug(`Unexpected frames_of_interest type: ${e.type}, ${JSON.stringify(e,null,2)}`)}})),0!==f.length&&(console.log("Kolo Warning: incomplete subtrees exist"),f.forEach(((e,t)=>{console.log(t,e.children.length,e.name)})));const b=function(t){const n=["django_setup","django_checks","django_create_test_db"],r=e(t);for(const[e,s]of r)n.includes(e.type)&&(s?s.children=s.children.filter((t=>t!==e)):t=t.filter((t=>t!==e)));return t}(d);return l(b),Object.assign({executionTreeNodes:b,totalExecutionTreeNodeCount:(w=b,w.reduce(((e,t)=>e+(1+t.all_children_count)),0))},h);var w}function i(e){const{exception_summary:t}=e;return t[t.length-1]}function o(e){var t;return void 0===e.type||"frame"===e.type?null!==(t=e.qualname)&&void 0!==t?t:`${e.path} ${e.co_name}`:"start_test"===e.type||"end_test"===e.type?`${e.test_name}`:"django_template_start"===e.type||"django_template_end"===e.type?`${e.template}`:"django_request"===e.type?`${e.method} ${e.path_info}`:"log_message"===e.type?e.msg:"end_sql_query"===e.type?`${e.query} (${e.frame_id})`:"outbound_http_request"===e.type?`${e.method_and_full_url}`:"background_job"===e.type||"background_job_end"===e.type?`${e.name}`:(["start_sql_query","django_setup_start","django_checks_start","django_create_test_db_start"].includes(e.type)||console.log(`Consider specifying a better frameOfInterestName for: ${e.type}`),`${e.type}`)}function a(e,t){const n={index:t,name:o(e),children:[],all_children_count:0,frame_id:e.frame_id};if("event"in e&&"call"===e.event)return Object.assign(Object.assign({},n),{type:"frame_span",data:{call_frame:e}});if("django_request"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"nested_served_http_request",data:{request:e}});if("start_sql_query"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"sql_query",data:{user_code_call_site:e.user_code_call_site,call_timestamp:e.call_timestamp}});if("outbound_http_request"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"outbound_http_request",subtype:e.subtype,data:{request:{url:e.url,body:e.body,method:e.method,headers:e.headers,timestamp:e.timestamp,method_and_full_url:e.method_and_full_url}}});if("start_test"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"nested_test",data:{test_name:e.test_name,test_class:e.test_class,call_timestamp:e.timestamp}});if("django_template_start"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"django_template",data:{call_timestamp:e.timestamp,template:e.template,call_context:e.context}});if("background_job"===(null==e?void 0:e.type)){const t={call_timestamp:e.timestamp,name:e.name,args:e.args,kwargs:e.kwargs,subtype:e.subtype};return Object.assign(Object.assign({},n),{type:"nested_background_job",data:t})}if("log_message"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"log_message",data:{level:e.level,args:e.args,extra:e.extra,msg:e.msg,stack:e.stack,traceback:e.traceback}});if("django_setup_start"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"django_setup",data:{}});if("django_checks_start"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"django_checks",data:{}});if("django_create_test_db_start"===(null==e?void 0:e.type))return Object.assign(Object.assign({},n),{type:"django_create_test_db",data:{}});throw new Error("Unexpected frameOfInterest: "+JSON.stringify(e,null,2))}const u=function(...e){return t=>e.reduce(((e,t)=>t(e)),t)}((e=>e.filter((e=>!("qualname"in e)||"urllib3.connectionpool.HTTPConnectionPool.urlopen"!==e.qualname))),(e=>{let t=0,n=0;return e.forEach((e=>{"background_job"===e.type?t++:"background_job_end"===e.type&&n++})),0!==t&&0===n?e.filter((e=>"background_job"!==e.type)):e.filter((e=>!("qualname"in e)||"celery.app.task.Task.apply_async"!==e.qualname))}),(e=>e.filter(((e,t,n)=>{const r=e.type;if(!["start_sql_query","end_sql_query"].includes(String(r)))return!0;if("start_sql_query"===e.type){let e=n[t+1];if("end_sql_query"!==e.type&&(e=n[t+2]),"end_sql_query"!==e.type&&console.log("Error: Expected end_sql_query after start_sql_query but got:",e),null===e.query)return!1}else if("end_sql_query"===e.type&&null===e.query)return!1;return!0}))));function l(e){e.forEach((e=>{e.children.forEach((e=>{l([e])})),e.all_children_count=function(e){const t=e.children.reduce(((e,t)=>e+t.all_children_count),0);return e.children.length+t}(e)}))}function c(e,s,i){const o=e.frame_id,a=s.frame_id,u=[];let l=0,c=[];for(let e of i){let s;s=e.type&&"frame"!==e.type?t.includes(e.type)?"call":n.includes(e.type)?"return":r.includes(e.type)?"leaf":"unknown_call_or_return":e.event;let i="  ".repeat(c.length);e.frame_id===o||e.frame_id===a?(l>0&&(u.push(`${i}(${l} frames)`),l=0),"call"===s?(u.push(`${i}${s} (${e.type}) {${e.frame_id}}`),c.push(s)):"return"===s&&(c.length>0&&c.pop(),i="  ".repeat(c.length),u.push(`${i}${s} (${e.type}) {${e.frame_id}}`))):l++}if(l>0){const e="  ".repeat(c.length);u.push(`${e}(${l} frames)`)}return u.join("\n")}var d,f,p;try{d=new TextDecoder}catch(e){}var h=0;const g=[];var _,y,m,b,w,v=g,k=0,j={},$=0,x=0,S=[],O={useRecords:!1,mapsAsObjects:!0};class E{}const U=new E;U.name="MessagePack 0xC1";var q=!1,A=2;try{new Function("")}catch(e){A=1/0}class I{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.sequential&&!1!==e.trusted&&(e.trusted=!0,e.structures||0==e.useRecords||(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(f)return oe((()=>(ae(),this?this.unpack(e,t):I.prototype.unpack.call(O,e,t))));e.buffer||e.constructor!==ArrayBuffer||(e="undefined"!=typeof Buffer?Buffer.from(e):new Uint8Array(e)),"object"==typeof t?(p=t.end||e.length,h=t.start||0):(h=0,p=t>-1?t:e.length),k=0,x=0,y=null,v=g,m=null,f=e;try{w=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(f=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof I){if(j=this,this.structures)return _=this.structures,B(t);(!_||_.length>0)&&(_=[])}else j=O,(!_||_.length>0)&&(_=[]);return B(t)}unpackMultiple(e,t){let n,r=0;try{q=!0;let s=e.length,i=this?this.unpack(e,s):le.unpack(e,s);if(!t){for(n=[i];h<s;)r=h,n.push(B());return n}if(!1===t(i,r,h))return;for(;h<s;)if(r=h,!1===t(B(),r,h))return}catch(e){throw e.lastPosition=r,e.values=n,e}finally{q=!1,ae()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map((e=>e.slice(0))));for(let t=0,n=e.length;t<n;t++){let n=e[t];n&&(n.isShared=!0,t>=32&&(n.highByte=t-32>>5))}e.sharedLength=e.length;for(let n in t||[])if(n>=0){let r=e[n],s=t[n];s&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[n]=r),e[n]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function B(e){try{if(!j.trusted&&!q){let e=_.sharedLength||0;e<_.length&&(_.length=e)}let e;if(j.randomAccessStructure&&f[h]<64&&f[h],e=M(),m&&(h=m.postBundlePosition,m=null),q&&(_.restoreStructures=null),h==p)_&&_.restoreStructures&&T(),_=null,f=null,b&&(b=null);else{if(h>p)throw new Error("Unexpected end of MessagePack data");if(!q){let t;try{t=JSON.stringify(e,((e,t)=>"bigint"==typeof t?`${t}n`:t)).slice(0,100)}catch(e){t="(JSON view not available "+e+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw _&&_.restoreStructures&&T(),ae(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||h>p)&&(e.incomplete=!0),e}}function T(){for(let e in _.restoreStructures)_[e]=_.restoreStructures[e];_.restoreStructures=null}function M(){let e=f[h++];if(e<160){if(e<128){if(e<64)return e;{let t=_[63&e]||j.getStructures&&D()[63&e];return t?(t.read||(t.read=C(t,63&e)),t.read()):e}}if(e<144){if(e-=128,j.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=ee();"__proto__"===e&&(e="__proto_"),t[e]=M()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(M(),M());return t}}{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=M();return j.freezeData?Object.freeze(t):t}}if(e<192){let t=e-160;if(x>=h)return y.slice(h-$,(h+=t)-$);if(0==x&&p<140){let e=t<16?Y(t):K(t);if(null!=e)return e}return F(t)}{let t;switch(e){case 192:return null;case 193:return m?(t=M(),t>0?m[1].slice(m.position1,m.position1+=t):m[0].slice(m.position0,m.position0-=t)):U;case 194:return!1;case 195:return!0;case 196:if(t=f[h++],void 0===t)throw new Error("Unexpected end of buffer");return G(t);case 197:return t=w.getUint16(h),h+=2,G(t);case 198:return t=w.getUint32(h),h+=4,G(t);case 199:return Q(f[h++]);case 200:return t=w.getUint16(h),h+=2,Q(t);case 201:return t=w.getUint32(h),h+=4,Q(t);case 202:if(t=w.getFloat32(h),j.useFloat32>2){let e=ue[(127&f[h])<<1|f[h+1]>>7];return h+=4,(e*t+(t>0?.5:-.5)>>0)/e}return h+=4,t;case 203:return t=w.getFloat64(h),h+=8,t;case 204:return f[h++];case 205:return t=w.getUint16(h),h+=2,t;case 206:return t=w.getUint32(h),h+=4,t;case 207:return"number"===j.int64AsType?(t=4294967296*w.getUint32(h),t+=w.getUint32(h+4)):"string"===j.int64AsType?t=w.getBigUint64(h).toString():"auto"===j.int64AsType?(t=w.getBigUint64(h),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=w.getBigUint64(h),h+=8,t;case 208:return w.getInt8(h++);case 209:return t=w.getInt16(h),h+=2,t;case 210:return t=w.getInt32(h),h+=4,t;case 211:return"number"===j.int64AsType?(t=4294967296*w.getInt32(h),t+=w.getUint32(h+4)):"string"===j.int64AsType?t=w.getBigInt64(h).toString():"auto"===j.int64AsType?(t=w.getBigInt64(h),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=w.getBigInt64(h),h+=8,t;case 212:if(t=f[h++],114==t)return te(63&f[h++]);{let e=S[t];if(e)return e.read?(h++,e.read(M())):e.noBuffer?(h++,e()):e(f.subarray(h,++h));throw new Error("Unknown extension "+t)}case 213:return t=f[h],114==t?(h++,te(63&f[h++],f[h++])):Q(2);case 214:return Q(4);case 215:return Q(8);case 216:return Q(16);case 217:return t=f[h++],x>=h?y.slice(h-$,(h+=t)-$):R(t);case 218:return t=w.getUint16(h),x>=(h+=2)?y.slice(h-$,(h+=t)-$):V(t);case 219:return t=w.getUint32(h),x>=(h+=4)?y.slice(h-$,(h+=t)-$):z(t);case 220:return t=w.getUint16(h),h+=2,W(t);case 221:return t=w.getUint32(h),h+=4,W(t);case 222:return t=w.getUint16(h),h+=2,J(t);case 223:return t=w.getUint32(h),h+=4,J(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}const N=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function C(e,t){function n(){if(n.count++>A){let n=e.read=new Function("r","return function(){return "+(j.freezeData?"Object.freeze":"")+"({"+e.map((e=>"__proto__"===e?"__proto_:r()":N.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"})}")(M);return 0===e.highByte&&(e.read=L(t,e.read)),n()}let r={};for(let t=0,n=e.length;t<n;t++){let n=e[t];"__proto__"===n&&(n="__proto_"),r[n]=M()}return j.freezeData?Object.freeze(r):r}return n.count=0,0===e.highByte?L(t,n):n}const L=(e,t)=>function(){let n=f[h++];if(0===n)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),s=_[r]||D()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=C(s,e)),s.read()};function D(){let e=oe((()=>(f=null,j.getStructures())));return _=j._mergeStructures(e,_)}var F=P,R=P,V=P,z=P;function P(e){let t;if(e<16&&(t=Y(e)))return t;if(e>64&&d)return d.decode(f.subarray(h,h+=e));const n=h+e,r=[];for(t="";h<n;){const e=f[h++];if(0==(128&e))r.push(e);else if(192==(224&e)){const t=63&f[h++];r.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&f[h++],n=63&f[h++];r.push((31&e)<<12|t<<6|n)}else if(240==(248&e)){let t=(7&e)<<18|(63&f[h++])<<12|(63&f[h++])<<6|63&f[h++];t>65535&&(t-=65536,r.push(t>>>10&1023|55296),t=56320|1023&t),r.push(t)}else r.push(e);r.length>=4096&&(t+=H.apply(String,r),r.length=0)}return r.length>0&&(t+=H.apply(String,r)),t}function W(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=M();return j.freezeData?Object.freeze(t):t}function J(e){if(j.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=ee();"__proto__"===e&&(e="__proto_"),t[e]=M()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(M(),M());return t}}var H=String.fromCharCode;function K(e){let t=h,n=new Array(e);for(let r=0;r<e;r++){const e=f[h++];if((128&e)>0)return void(h=t);n[r]=e}return H.apply(String,n)}function Y(e){if(e<4){if(e<2){if(0===e)return"";{let e=f[h++];return(128&e)>1?void(h-=1):H(e)}}{let t=f[h++],n=f[h++];if((128&t)>0||(128&n)>0)return void(h-=2);if(e<3)return H(t,n);let r=f[h++];return(128&r)>0?void(h-=3):H(t,n,r)}}{let t=f[h++],n=f[h++],r=f[h++],s=f[h++];if((128&t)>0||(128&n)>0||(128&r)>0||(128&s)>0)return void(h-=4);if(e<6){if(4===e)return H(t,n,r,s);{let e=f[h++];return(128&e)>0?void(h-=5):H(t,n,r,s,e)}}if(e<8){let i=f[h++],o=f[h++];if((128&i)>0||(128&o)>0)return void(h-=6);if(e<7)return H(t,n,r,s,i,o);let a=f[h++];return(128&a)>0?void(h-=7):H(t,n,r,s,i,o,a)}{let i=f[h++],o=f[h++],a=f[h++],u=f[h++];if((128&i)>0||(128&o)>0||(128&a)>0||(128&u)>0)return void(h-=8);if(e<10){if(8===e)return H(t,n,r,s,i,o,a,u);{let e=f[h++];return(128&e)>0?void(h-=9):H(t,n,r,s,i,o,a,u,e)}}if(e<12){let l=f[h++],c=f[h++];if((128&l)>0||(128&c)>0)return void(h-=10);if(e<11)return H(t,n,r,s,i,o,a,u,l,c);let d=f[h++];return(128&d)>0?void(h-=11):H(t,n,r,s,i,o,a,u,l,c,d)}{let l=f[h++],c=f[h++],d=f[h++],p=f[h++];if((128&l)>0||(128&c)>0||(128&d)>0||(128&p)>0)return void(h-=12);if(e<14){if(12===e)return H(t,n,r,s,i,o,a,u,l,c,d,p);{let e=f[h++];return(128&e)>0?void(h-=13):H(t,n,r,s,i,o,a,u,l,c,d,p,e)}}{let g=f[h++],_=f[h++];if((128&g)>0||(128&_)>0)return void(h-=14);if(e<15)return H(t,n,r,s,i,o,a,u,l,c,d,p,g,_);let y=f[h++];return(128&y)>0?void(h-=15):H(t,n,r,s,i,o,a,u,l,c,d,p,g,_,y)}}}}}function Z(){let e,t=f[h++];if(t<192)e=t-160;else switch(t){case 217:e=f[h++];break;case 218:e=w.getUint16(h),h+=2;break;case 219:e=w.getUint32(h),h+=4;break;default:throw new Error("Expected string")}return P(e)}function G(e){return j.copyBuffers?Uint8Array.prototype.slice.call(f,h,h+=e):f.subarray(h,h+=e)}function Q(e){let t=f[h++];if(S[t]){let n;return S[t](f.subarray(h,n=h+=e),(e=>{h=e;try{return M()}finally{h=n}}))}throw new Error("Unknown extension type "+t)}var X=new Array(4096);function ee(){let e=f[h++];if(!(e>=160&&e<192))return h--,M().toString();if(e-=160,x>=h)return y.slice(h-$,(h+=e)-$);if(!(0==x&&p<180))return F(e);let t,n=4095&(e<<5^(e>1?w.getUint16(h):e>0?f[h]:0)),r=X[n],s=h,i=h+e-3,o=0;if(r&&r.bytes==e){for(;s<i;){if(t=w.getUint32(s),t!=r[o++]){s=1879048192;break}s+=4}for(i+=3;s<i;)if(t=f[s++],t!=r[o++]){s=1879048192;break}if(s===i)return h=s,r.string;i-=3,s=h}for(r=[],X[n]=r,r.bytes=e;s<i;)t=w.getUint32(s),r.push(t),s+=4;for(i+=3;s<i;)t=f[s++],r.push(t);let a=e<16?Y(e):K(e);return r.string=null!=a?a:F(e)}const te=(e,t)=>{let n=M().map((e=>e.toString())),r=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let s=_[e];return s&&(s.isShared||q)&&((_.restoreStructures||(_.restoreStructures=[]))[e]=s),_[e]=n,n.read=C(n,r),n.read()};S[0]=()=>{},S[0].noBuffer=!0;let ne={Error,TypeError,ReferenceError};S[101]=()=>{let e=M();return(ne[e[0]]||Error)(e[1])},S[105]=e=>{let t=w.getUint32(h-4);b||(b=new Map);let n,r=f[h];n=r>=144&&r<160||220==r||221==r?[]:{};let s={target:n};b.set(t,s);let i=M();return s.used?Object.assign(n,i):(s.target=i,i)},S[112]=e=>{let t=w.getUint32(h-4),n=b.get(t);return n.used=!0,n.target},S[115]=()=>new Set(M());const re=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));let se="object"==typeof globalThis?globalThis:window;S[116]=e=>{let t=e[0],n=re[t];if(!n)throw new Error("Could not find typed array for code "+t);return new se[n](Uint8Array.prototype.slice.call(e,1).buffer)},S[120]=()=>{let e=M();return new RegExp(e[0],e[1])};const ie=[];function oe(e){let t=p,n=h,r=k,s=$,i=x,o=y,a=v,u=b,l=m,c=new Uint8Array(f.slice(0,p)),d=_,g=_.slice(0,_.length),S=j,O=q,E=e();return p=t,h=n,k=r,$=s,x=i,y=o,v=a,b=u,m=l,f=c,q=O,(_=d).splice(0,_.length,...g),j=S,w=new DataView(f.buffer,f.byteOffset,f.byteLength),E}function ae(){f=null,b=null,_=null}S[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=h;return h+=t-e.length,m=ie,(m=[Z(),Z()]).position0=0,m.position1=0,m.postBundlePosition=h,h=n,M()},S[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");const ue=new Array(147);for(let e=0;e<256;e++)ue[e]=+("1e"+Math.floor(45.15-.30103*e));var le=new I({useRecords:!1});le.unpack,le.unpackMultiple,le.unpack;let ce,de,fe,pe=new Float32Array(1);new Uint8Array(pe.buffer,0,4);try{ce=new TextEncoder}catch(e){}const he="undefined"!=typeof Buffer,ge=he?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,_e=he?Buffer:Uint8Array,ye=he?4294967296:2144337920;let me,be,we,ve,ke=0,je=null;const $e=/[\u0080-\uFFFF]/,xe=Symbol("record-id");class Se extends I{constructor(e){let t,n,r,s;super(e),this.offset=0;let i=_e.prototype.utf8Write?function(e,t){return me.utf8Write(e,t,4294967295)}:!(!ce||!ce.encodeInto)&&function(e,t){return ce.encodeInto(e,me.subarray(t)).written},o=this;e||(e={});let a=e&&e.sequential,u=e.structures||e.saveStructures,l=e.maxSharedStructures;if(null==l&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&null==e.moreTypes&&(this.moreTypes=!0);let c=e.maxOwnStructures;null==c&&(c=u?32:64),this.structures||0==e.useRecords||(this.structures=[]);let d=l>32||c+l>64,f=l+64,p=l+c+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let h=[],g=0,_=0;this.pack=this.encode=function(e,i){if(me||(me=new ge(8192),we=me.dataView||(me.dataView=new DataView(me.buffer,0,8192)),ke=0),ve=me.length-10,ve-ke<2048?(me=new ge(me.length),we=me.dataView||(me.dataView=new DataView(me.buffer,0,me.length)),ve=me.length-10,ke=0):ke=ke+7&2147483640,t=ke,i&De&&(ke+=255&i),s=o.structuredClone?new Map:null,o.bundleStrings&&"string"!=typeof e?(je=[],je.size=1/0):je=null,r=o.structures,r){r.uninitialized&&(r=o._mergeStructures(o.getStructures()));let e=r.sharedLength||0;if(e>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,s=r.transitions;for(let t=0,r=e.length;t<r;t++){let r=e[t];n=s[r],n||(n=s[r]=Object.create(null)),s=n}s[xe]=t+64}this.lastNamedStructuresLength=e}a||(r.nextId=e+64)}n&&(n=!1);try{o.randomAccessStructure&&e&&e.constructor&&e.constructor===Object?O(e):b(e);let a=je;if(je&&qe(t,b,0),s&&s.idsToInsert){let e=s.idsToInsert.sort(((e,t)=>e.offset>t.offset?1:-1)),n=e.length,r=-1;for(;a&&n>0;){let s=e[--n].offset+t;s<a.stringsPosition+t&&-1===r&&(r=0),s>a.position+t?r>=0&&(r+=6):(r>=0&&(we.setUint32(a.position+t,we.getUint32(a.position+t)+r),r=-1),a=a.previous,n++)}r>=0&&a&&we.setUint32(a.position+t,we.getUint32(a.position+t)+r),ke+=6*e.length,ke>ve&&$(ke),o.offset=ke;let i=function(e,t){let n,r=6*t.length,s=e.length-r;for(;n=t.pop();){let t=n.offset,i=n.id;e.copyWithin(t+r,t,s),r-=6;let o=t+r;e[o++]=214,e[o++]=105,e[o++]=i>>24,e[o++]=i>>16&255,e[o++]=i>>8&255,e[o++]=255&i,s=t}return e}(me.subarray(t,ke),e);return s=null,i}return o.offset=ke,i&Ce?(me.start=t,me.end=ke,me):me.subarray(t,ke)}finally{if(r&&(y(),n&&o.saveStructures)){let n=r.sharedLength||0,s=me.subarray(t,ke),a=function(e,t){return e.isCompatible=e=>{let n=!e||(t.lastNamedStructuresLength||0)===e.length;return n||t._mergeStructures(e),n},e}(r,o);return!1===o.saveStructures(a,a.isCompatible)?o.pack(e,i):(o.lastNamedStructuresLength=n,s)}i&Le&&(ke=t)}};const y=()=>{_<10&&_++;let e=r.sharedLength||0;if(r.length>e&&!a&&(r.length=e),g>1e4)r.transitions=null,_=0,g=0,h.length>0&&(h=[]);else if(h.length>0&&!a){for(let e=0,t=h.length;e<t;e++)h[e][xe]=0;h=[]}},m=e=>{var t=e.length;t<16?me[ke++]=144|t:t<65536?(me[ke++]=220,me[ke++]=t>>8,me[ke++]=255&t):(me[ke++]=221,we.setUint32(ke,t),ke+=4);for(let n=0;n<t;n++)b(e[n])},b=e=>{ke>ve&&(me=$(ke));var n,r=typeof e;if("string"===r){let r,s=e.length;if(je&&s>=4&&s<4096){if((je.size+=s)>21760){let e,n,r=(je[0]?3*je[0].length+je[1].length:0)+10;ke+r>ve&&(me=$(ke+r)),je.position?(n=je,me[ke]=200,ke+=3,me[ke++]=98,e=ke-t,ke+=4,qe(t,b,0),we.setUint16(e+t-3,ke-t-e)):(me[ke++]=214,me[ke++]=98,e=ke-t,ke+=4),je=["",""],je.previous=n,je.size=0,je.position=e}let n=$e.test(e);return je[n?0:1]+=e,me[ke++]=193,void b(n?-s:s)}r=s<32?1:s<256?2:s<65536?3:5;let o=3*s;if(ke+o>ve&&(me=$(ke+o)),s<64||!i){let t,i,o,a=ke+r;for(t=0;t<s;t++)i=e.charCodeAt(t),i<128?me[a++]=i:i<2048?(me[a++]=i>>6|192,me[a++]=63&i|128):55296==(64512&i)&&56320==(64512&(o=e.charCodeAt(t+1)))?(i=65536+((1023&i)<<10)+(1023&o),t++,me[a++]=i>>18|240,me[a++]=i>>12&63|128,me[a++]=i>>6&63|128,me[a++]=63&i|128):(me[a++]=i>>12|224,me[a++]=i>>6&63|128,me[a++]=63&i|128);n=a-ke-r}else n=i(e,ke+r);n<32?me[ke++]=160|n:n<256?(r<2&&me.copyWithin(ke+2,ke+1,ke+1+n),me[ke++]=217,me[ke++]=n):n<65536?(r<3&&me.copyWithin(ke+3,ke+2,ke+2+n),me[ke++]=218,me[ke++]=n>>8,me[ke++]=255&n):(r<5&&me.copyWithin(ke+5,ke+3,ke+3+n),me[ke++]=219,we.setUint32(ke,n),ke+=4),ke+=n}else if("number"===r)if(e>>>0===e)e<32||e<128&&!1===this.useRecords||e<64&&!this.randomAccessStructure?me[ke++]=e:e<256?(me[ke++]=204,me[ke++]=e):e<65536?(me[ke++]=205,me[ke++]=e>>8,me[ke++]=255&e):(me[ke++]=206,we.setUint32(ke,e),ke+=4);else if(e>>0===e)e>=-32?me[ke++]=256+e:e>=-128?(me[ke++]=208,me[ke++]=e+256):e>=-32768?(me[ke++]=209,we.setInt16(ke,e),ke+=2):(me[ke++]=210,we.setInt32(ke,e),ke+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let n;if(me[ke++]=202,we.setFloat32(ke,e),t<4||(n=e*ue[(127&me[ke])<<1|me[ke+1]>>7])>>0===n)return void(ke+=4);ke--}me[ke++]=203,we.setFloat64(ke,e),ke+=8}else if("object"===r||"function"===r)if(e){if(s){let n=s.get(e);if(n){if(!n.id){let e=s.idsToInsert||(s.idsToInsert=[]);n.id=e.push(n)}return me[ke++]=214,me[ke++]=112,we.setUint32(ke,n.id),void(ke+=4)}s.set(e,{offset:ke-t})}let i=e.constructor;if(i===Object)j(e,!0);else if(i===Array)m(e);else if(i===Map)if(this.mapAsEmptyObject)me[ke++]=128;else{(n=e.size)<16?me[ke++]=128|n:n<65536?(me[ke++]=222,me[ke++]=n>>8,me[ke++]=255&n):(me[ke++]=223,we.setUint32(ke,n),ke+=4);for(let[t,n]of e)b(t),b(n)}else{for(let t=0,n=de.length;t<n;t++)if(e instanceof fe[t]){let n=de[t];if(n.write){n.type&&(me[ke++]=212,me[ke++]=n.type,me[ke++]=0);let t=n.write.call(this,e);return void(t===e?Array.isArray(e)?m(e):j(e):b(t))}let r,s=me,i=we,o=ke;me=null;try{r=n.pack.call(this,e,(e=>(me=s,s=null,ke+=e,ke>ve&&$(ke),{target:me,targetView:we,position:ke-e})),b)}finally{s&&(me=s,we=i,ke=o,ve=me.length-10)}return void(r&&(r.length+ke>ve&&$(r.length+ke),ke=Ue(r,me,ke,n.type)))}if(Array.isArray(e))m(e);else{if(e.toJSON){const t=e.toJSON();if(t!==e)return b(t)}if("function"===r)return b(this.writeFunction&&this.writeFunction(e));j(e,!e.hasOwnProperty)}}}else me[ke++]=192;else if("boolean"===r)me[ke++]=e?195:194;else if("bigint"===r){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))me[ke++]=211,we.setBigInt64(ke,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)me[ke++]=207,we.setBigUint64(ke,e);else{if(!this.largeBigIntToFloat)throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");me[ke++]=203,we.setFloat64(ke,Number(e))}ke+=8}else{if("undefined"!==r)throw new Error("Unknown type: "+r);this.encodeUndefinedAsNil?me[ke++]=192:(me[ke++]=212,me[ke++]=0,me[ke++]=0)}},w=this.variableMapSize||this.coercibleKeyAsNumber?e=>{let t,n=Object.keys(e),r=n.length;if(r<16?me[ke++]=128|r:r<65536?(me[ke++]=222,me[ke++]=r>>8,me[ke++]=255&r):(me[ke++]=223,we.setUint32(ke,r),ke+=4),this.coercibleKeyAsNumber)for(let s=0;s<r;s++){t=n[s];let r=Number(t);b(isNaN(r)?t:r),b(e[t])}else for(let s=0;s<r;s++)b(t=n[s]),b(e[t])}:(e,n)=>{me[ke++]=222;let r=ke-t;ke+=2;let s=0;for(let t in e)(n||e.hasOwnProperty(t))&&(b(t),b(e[t]),s++);me[r+++t]=s>>8,me[r+t]=255&s},v=!1===this.useRecords?w:e.progressiveRecords&&!d?(e,n)=>{let s,i,o=r.transitions||(r.transitions=Object.create(null)),a=ke++-t;for(let u in e)if(n||e.hasOwnProperty(u)){if(s=o[u],s)o=s;else{let n=Object.keys(e),l=o;o=r.transitions;let c=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];s=o[t],s||(s=o[t]=Object.create(null),c++),o=s}a+t+1==ke?(ke--,x(o,n,c)):S(o,n,a,c),i=!0,o=l[u]}b(e[u])}if(!i){let n=o[xe];n?me[a+t]=n:S(o,Object.keys(e),a,0)}}:(e,t)=>{let n,s=r.transitions||(r.transitions=Object.create(null)),i=0;for(let r in e)(t||e.hasOwnProperty(r))&&(n=s[r],n||(n=s[r]=Object.create(null),i++),s=n);let o=s[xe];o?o>=96&&d?(me[ke++]=96+(31&(o-=96)),me[ke++]=o>>5):me[ke++]=o:x(s,s.__keys__||Object.keys(e),i);for(let n in e)(t||e.hasOwnProperty(n))&&b(e[n])},k="function"==typeof this.useRecords&&this.useRecords,j=k?(e,t)=>{k(e)?v(e,t):w(e,t)}:v,$=e=>{let n;if(e>16777216){if(e-t>ye)throw new Error("Packed buffer would be larger than maximum buffer size");n=Math.min(ye,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else n=1+(Math.max(e-t<<2,me.length-1)>>12)<<12;let r=new ge(n);return we=r.dataView||(r.dataView=new DataView(r.buffer,0,n)),e=Math.min(e,me.length),me.copy?me.copy(r,0,t,e):r.set(me.slice(t,e)),ke-=t,t=0,ve=r.length-10,me=r},x=(e,t,s)=>{let i=r.nextId;i||(i=64),i<f&&this.shouldShareStructure&&!this.shouldShareStructure(t)?(i=r.nextOwnId,i<p||(i=f),r.nextOwnId=i+1):(i>=p&&(i=f),r.nextId=i+1);let o=t.highByte=i>=96&&d?i-96>>5:-1;e[xe]=i,e.__keys__=t,r[i-64]=t,i<f?(t.isShared=!0,r.sharedLength=i-63,n=!0,o>=0?(me[ke++]=96+(31&i),me[ke++]=o):me[ke++]=i):(o>=0?(me[ke++]=213,me[ke++]=114,me[ke++]=96+(31&i),me[ke++]=o):(me[ke++]=212,me[ke++]=114,me[ke++]=i),s&&(g+=_*s),h.length>=c&&(h.shift()[xe]=0),h.push(e),b(t))},S=(e,n,r,s)=>{let i=me,o=ke,a=ve,u=t;me=be,ke=0,t=0,me||(be=me=new ge(8192)),ve=me.length-10,x(e,n,s),be=me;let l=ke;if(me=i,ke=o,ve=a,t=u,l>1){let e=ke+l-1;e>ve&&$(e);let n=r+t;me.copyWithin(n+l,n+1,ke),me.set(be.slice(0,l),n),ke=e}else me[r+t]=be[0]},O=(e,s)=>{let i=undefined(e,me,t,ke,r,$,((e,t,r)=>{if(r)return n=!0;ke=t;let s=me;return b(e),y(),s!==me?{position:ke,targetView:we,target:me}:ke}),this);if(0===i)return j(e,!0);ke=i}}useBuffer(e){me=e,we=new DataView(me.buffer,me.byteOffset,me.byteLength),ke=0}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}function Oe(e,t,n,r){let s=e.byteLength;if(s+1<256){var{target:i,position:o}=n(4+s);i[o++]=199,i[o++]=s+1}else if(s+1<65536){var{target:i,position:o}=n(5+s);i[o++]=200,i[o++]=s+1>>8,i[o++]=s+1&255}else{var{target:i,position:o,targetView:a}=n(7+s);i[o++]=201,a.setUint32(o,s+1),o+=4}i[o++]=116,i[o++]=t,i.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Ee(e,t){let n=e.byteLength;var r,s;if(n<256){var{target:r,position:s}=t(n+2);r[s++]=196,r[s++]=n}else if(n<65536){var{target:r,position:s}=t(n+3);r[s++]=197,r[s++]=n>>8,r[s++]=255&n}else{var{target:r,position:s,targetView:i}=t(n+5);r[s++]=198,i.setUint32(s,n),s+=4}r.set(e,s)}function Ue(e,t,n,r){let s=e.length;switch(s){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:s<256?(t[n++]=199,t[n++]=s):s<65536?(t[n++]=200,t[n++]=s>>8,t[n++]=255&s):(t[n++]=201,t[n++]=s>>24,t[n++]=s>>16&255,t[n++]=s>>8&255,t[n++]=255&s)}return t[n++]=r,t.set(e,n),n+s}function qe(e,t,n){if(je.length>0){we.setUint32(je.position+e,ke+n-je.position-e),je.stringsPosition=ke-e;let r=je;je=null,t(r[0]),t(r[1])}}function Ae(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");fe.unshift(e.Class),de.unshift(e)}!function(e){e.unpack?S[e.type]=e.unpack:S[e.type]=e}(e)}fe=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,E],de=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296){let{target:e,targetView:n,position:s}=t(6);e[s++]=214,e[s++]=255,n.setUint32(s,r)}else if(r>0&&r<4294967296){let{target:n,targetView:s,position:i}=t(10);n[i++]=215,n[i++]=255,s.setUint32(i,4e6*e.getMilliseconds()+(r/1e3/4294967296>>0)),s.setUint32(i+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:e,targetView:r,position:s}=t(3);e[s++]=212,e[s++]=255,e[s++]=255}else{let{target:n,targetView:s,position:i}=t(15);n[i++]=199,n[i++]=12,n[i++]=255,s.setUint32(i,1e6*e.getMilliseconds()),s.setBigInt64(i+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:s,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=115,s[i++]=0),n(r)}},{pack(e,t,n){let{target:r,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(r[s++]=212,r[s++]=101,r[s++]=0),n([e.name,e.message])}},{pack(e,t,n){let{target:r,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(r[s++]=212,r[s++]=120,r[s++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Oe(e,16,t):Ee(he?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==_e&&this.moreTypes?Oe(e,re.indexOf(n.name),t):Ee(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];let Ie=new Se({useRecords:!1});Ie.pack,Ie.pack;const{NEVER:Be,ALWAYS:Te,DECIMAL_ROUND:Me,DECIMAL_FIT:Ne}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},Ce=512,Le=1024,De=2048;let Fe=new Se({useRecords:!1});function Re(){}function Ve(e){return e()}function ze(){return Object.create(null)}function Pe(e){e.forEach(Ve)}function We(e){return"function"==typeof e}function Je(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function He(e){return 0===Object.keys(e).length}Ae({type:0,unpack:e=>e.toString("utf-8")}),Ae({type:1,unpack:e=>e.toString("utf-8")}),Ae({type:2,unpack:e=>e.toString("utf-8")}),Ae({type:3,unpack:e=>e.toString("utf-8")}),Ae({type:4,unpack:e=>function(e){e.length%2&&(e="0"+e);var t=parseInt(e.slice(0,2),16),n=BigInt("0x"+e);return 128&t&&(n=-(n=BigInt("0b"+n.toString(2).split("").map((function(e){return"0"===e?1:0})).join(""))+BigInt(1))),n}(e.toString("hex"))}),Ae({type:5,unpack:e=>Number(e.toString("utf-8"))}),Ae({type:127,unpack:e=>`SerializationError: Unserializable \`${e.toString("utf-8")}\` instance`}),new Set;const Ke="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class Ye{constructor(e){this.options=e,this._listeners="WeakMap"in Ke?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return null!==(e=this._observer)&&void 0!==e?e:this._observer=new ResizeObserver((e=>{var t;for(const n of e)Ye.entries.set(n.target,n),null===(t=this._listeners.get(n.target))||void 0===t||t(n)}))}}Ye.entries="WeakMap"in Ke?new WeakMap:void 0;let Ze,Ge=!1;function Qe(e){e.parentNode&&e.parentNode.removeChild(e)}function Xe(e){Ze=e}new Map;const et=[],tt=[];let nt=[];const rt=[],st=Promise.resolve();let it=!1;function ot(e){nt.push(e)}const at=new Set;let ut=0;function lt(){if(0!==ut)return;const e=Ze;do{try{for(;ut<et.length;){const e=et[ut];ut++,Xe(e),ct(e.$$)}}catch(e){throw et.length=0,ut=0,e}for(Xe(null),et.length=0,ut=0;tt.length;)tt.pop()();for(let e=0;e<nt.length;e+=1){const t=nt[e];at.has(t)||(at.add(t),t())}nt.length=0}while(et.length);for(;rt.length;)rt.pop()();it=!1,at.clear(),Xe(e)}function ct(e){if(null!==e.fragment){e.update(),Pe(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ot)}}const dt=new Set;let ft;function pt(e,t){const n=e.$$;null!==n.fragment&&(function(e){const t=[],n=[];nt.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),nt=t}(n.after_update),Pe(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ht(e,t,n,r,s,i,o,a=[-1]){const u=Ze;Xe(e);const l=e.$$={fragment:null,ctx:[],props:i,update:Re,not_equal:s,bound:ze(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:ze(),dirty:a,skip_bound:!1,root:t.target||u.$$.root};o&&o(l.root);let c=!1;if(l.ctx=n?n(e,t.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return l.ctx&&s(l.ctx[t],l.ctx[t]=i)&&(!l.skip_bound&&l.bound[t]&&l.bound[t](i),c&&function(e,t){-1===e.$$.dirty[0]&&(et.push(e),it||(it=!0,st.then(lt)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],l.update(),c=!0,Pe(l.before_update),l.fragment=!!r&&r(l.ctx),t.target){if(t.hydrate){Ge=!0;const e=(p=t.target,Array.from(p.childNodes));l.fragment&&l.fragment.l(e),e.forEach(Qe)}else l.fragment&&l.fragment.c();t.intro&&((d=e.$$.fragment)&&d.i&&(dt.delete(d),d.i(f))),function(e,t,n,r){const{fragment:s,after_update:i}=e.$$;s&&s.m(t,n),r||ot((()=>{const t=e.$$.on_mount.map(Ve).filter(We);e.$$.on_destroy?e.$$.on_destroy.push(...t):Pe(t),e.$$.on_mount=[]})),i.forEach(ot)}(e,t.target,t.anchor,t.customElement),Ge=!1,lt()}var d,f,p;Xe(u)}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(ft=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(Ve).filter(We);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){Pe(this.$$.on_disconnect)}$destroy(){pt(this,1),this.$destroy=Re}$on(e,t){if(!We(t))return Re;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!He(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class gt{$destroy(){pt(this,1),this.$destroy=Re}$on(e,t){if(!We(t))return Re;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!He(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function _t(e){let t;return{c(){var e,n,r,s;s="div",t=document.createElement(s),t.innerHTML='<h1 class="text-4xl mb-4 font-bold">Kolo</h1> \n  <div id="traces" class="flex flex-col"></div>',e=t,n="class",null==(r="m-4")?e.removeAttribute(n):e.getAttribute(n)!==r&&e.setAttribute(n,r)},m(e,n){!function(e,t,n){e.insertBefore(t,n||null)}(e,t,n)},p:Re,i:Re,o:Re,d(e){e&&Qe(t)}}}const yt=class extends gt{constructor(e){super(),ht(this,e,null,_t,Je,{})}};var mt=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))};function bt(e){return mt(this,void 0,void 0,(function*(){const t=yield fetch(`api/traces/${e}/`);let n;var r;"application/msgpack"===t.headers.get("content-type")?(r=new Uint8Array(yield t.arrayBuffer()),n=Fe.unpack(r)):n=yield t.json();const i=s(n.frames_of_interest);window.dispatchEvent(new CustomEvent("web-load-viz",{detail:{tree:i,traceId:e}}))}))}document.addEventListener("DOMContentLoaded",(function(){return mt(this,void 0,void 0,(function*(){new yt({target:document.getElementById("app")});const e=yield(yield fetch("api/latest-traces/")).json();document.getElementById("traces").innerHTML=e.traces.map((e=>'<div class="trace my-1 p-2 border-2 rounded-md cursor-pointer">'+e+"</div>")).join("");const t=document.getElementsByClassName("trace");for(const e of t)e.addEventListener("click",(e=>{bt(e.target.innerHTML)}));bt(e.traces[0]),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{window.dispatchEvent(new CustomEvent("message",{detail:{command:"themeChange"}}))}))}))}))})();
//# sourceMappingURL=main.js.map