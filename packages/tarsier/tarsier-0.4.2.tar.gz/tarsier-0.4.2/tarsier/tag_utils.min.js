"use strict";const elIsClean=e=>{if(e.style&&e.style.display==="none"||e.hidden||e.disabled)return!1;const t=e.getBoundingClientRect();return!(t.width===0||t.height===0||e.tagName==="SCRIPT"||e.tagName==="STYLE")},inputs=["a","button","textarea","select","details","label"],isInteractable=e=>inputs.includes(e.tagName.toLowerCase())||e.tagName.toLowerCase()==="input"&&e.type!=="hidden"||e.role==="button",emptyTagWhitelist=["input","textarea","select","button"],isEmpty=e=>{const t=e.tagName.toLowerCase();if(emptyTagWhitelist.includes(t))return!1;if("innerText"in e&&e.innerText.trim().length===0){const s=e.querySelector("svg"),n=e.querySelector("img");return!(s||n)}return!1};function getElementXPath(e){let t=[],s="";for(e&&e.ownerDocument!==window.document&&(s=`iframe[${e.getAttribute("iframe_index")}]`);e;){if(!e.tagName){e=e.parentNode;continue}let n=e.tagName.toLowerCase(),o=1,l=e.previousElementSibling;for(;l;)l.tagName===e.tagName&&o++,l=l.previousElementSibling;let i=e.nextElementSibling,a=!1;for(;i;){if(i.tagName===e.tagName){a=!0;break}i=i.nextElementSibling}if((o>1||a)&&(n+=`[${o}]`),e.id)return n+=`[@id="${e.id}"]`,t.unshift(n),"//"+t.join("/");if(e.className){const c=Array.from(e.classList).map(d=>`contains(concat(" ", normalize-space(@class), " "), " ${d} ")`).join(" and ");c.length>0&&(n+=`[${c}]`)}t.unshift(n),e=e.parentNode}return s+"//"+t.join("/")}function create_tagged_span(e){let t=document.createElement("span");return t.id="__tarsier_id",t.style.all="inherit",t.style.display="inline",t.style.color="white",t.style.backgroundColor="red",t.textContent=e,t}window.tagifyWebpage=(e=!1)=>{window.removeTags();let t=0,s={},n=[...document.body.querySelectorAll("*")];const o=document.getElementsByTagName("iframe");for(let i=0;i<o.length;i++)try{const a=o[i];console.log("iframe!",o[i]);const c=[...(a.contentDocument||a.contentWindow?.document).querySelectorAll("*")];c.forEach(d=>d.setAttribute("iframe_index",i)),n.push(...c)}catch(a){console.error("Cross-origin iframe:",a)}n.map(i=>{isInteractable(i)&&i.childNodes.forEach(a=>{const r=n.indexOf(a);r>-1&&n.splice(r,1)})});const l=["input","textarea","select"];for(let i of n){if(isEmpty(i)||!elIsClean(i))continue;const a=isInteractable(i),r=i.tagName.toLowerCase(),c=l.includes(r)?`{${t}}`:`[${t}]`;s[t]=getElementXPath(i);let d=create_tagged_span(c);a?l.includes(r)?(r==="textarea"||r==="input")&&i.prepend(d):i.prepend(d):e&&/\S/.test(i.textContent||"")&&Array.from(i.childNodes).every(f=>f.nodeType===Node.TEXT_NODE)&&i.prepend(d),t++}return s},window.removeTags=()=>{document.querySelectorAll("#__tarsier_id").forEach(t=>t.remove())};
