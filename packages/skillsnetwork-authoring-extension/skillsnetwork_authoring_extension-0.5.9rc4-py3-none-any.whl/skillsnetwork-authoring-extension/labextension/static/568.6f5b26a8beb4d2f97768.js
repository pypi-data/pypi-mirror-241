"use strict";(self.webpackChunkskillsnetwork_authoring_extension=self.webpackChunkskillsnetwork_authoring_extension||[]).push([[568],{7953:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{Z:()=>_});var a=o(6835),i=o(5777),l=o(5923),s=o(499),r=o(8623),c=o(3311),d=o(6973),u=o(3619),h=o(3191),w=o.n(h),b=o(7423),p=o(5449),y=t([u,r,c,p]);[u,r,c,p]=y.then?(await y)():y;const g={activate:f,id:"skillsnetwork-authoring-extension:plugin",autoStart:!0,requires:[s.IMainMenu,b.INotebookTracker,a.IDocumentManager]};class m{createNew(t,e){if(u.OH.SHOW_PUBLISH_BUTTON_FOR!==e.path)return new l.DisposableDelegate((()=>{}));{const o=async()=>{const o=await(0,r.nu)(t,e),n=u.OH.TOKENS.get(t.id);void 0!==n?"version_id"in w()(n)?(0,c.Wk)((0,c.So)(n),o,n):(0,c.nK)((0,c.SJ)(n),o):console.log("No atlas or awb token found for id",t.id)},n=async()=>{const o=await(0,r.nu)(t,e),n=new Blob([o],{type:"application/x-ipynb+json"}),a=URL.createObjectURL(n),i=document.createElement("a");i.setAttribute("download",e.path),i.setAttribute("href",a),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},a=new i.ToolbarButton({className:"download-lab-button",label:"Download Notebook",onClick:n,tooltip:"Download the current notebook ipynb file to your local system"}),s=new i.ToolbarButton({className:"publish-lab-button",label:"Publish on SN",onClick:o,tooltip:"Publish Lab"}),d=new i.ToolbarButton({className:"sn-file-library-button",label:"SN File Library",onClick:()=>new p.E(t.id).launch(),tooltip:"Skills Network File Library"});return t.toolbar.insertItem(8,"download",a),t.toolbar.insertItem(9,"sn-file-library",d),t.toolbar.insertItem(10,"publish",s),new l.DisposableDelegate((()=>{a.dispose(),s.dispose(),d.dispose()}))}}}async function f(t,e,o,n){if(console.log("Activated skillsnetwork-authoring-extension button plugin!"),"learn"==await(0,u.IK)())return;const a=await(0,u.Nz)(),l=await(0,u.fe)(),s=await(0,u.D2)();console.log("Using default kernel: ",u.OH.PY_KERNEL_NAME),t.docRegistry.addWidgetExtension("Notebook",new m),t.restored.then((async()=>{if("NO_TOKEN"!==a&&"local"!==s)try{await(0,r._Y)(a,n)}catch(t){i.Dialog.flush(),(0,d.YZ)(),console.log(t)}else if("NO_TOKEN"!==l&&"local"!==s)try{await(0,r.Ps)(l,n)}catch(t){i.Dialog.flush(),(0,d.YZ)(),console.log(t)}}))}const _=g;n()}catch(k){n(k)}}))},3619:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{CC:()=>s,D2:()=>u,DO:()=>l,IK:()=>r,Nz:()=>c,OH:()=>w,XM:()=>i,fe:()=>d});var a=o(8957);const t=t=>{let e=t.baseUrl;return e.endsWith("/")||(e+="/"),e},i=await(async()=>{const e=window.location.href,o=new URL(e).searchParams.get("atlas_base_url");if(null===o){const e={method:"GET"},o=a.ServerConnection.makeSettings(),n=t(o)+"skillsnetwork-authoring-extension/config",i=await a.ServerConnection.makeRequest(n,e,o);return(await i.json()).ATLAS_BASE_URL}return decodeURIComponent(o)})(),l=await(async()=>{const e=window.location.href,o=new URL(e).searchParams.get("awb_base_url");if(null===o){const e={method:"GET"},o=a.ServerConnection.makeSettings(),n=t(o)+"skillsnetwork-authoring-extension/config",i=await a.ServerConnection.makeRequest(n,e,o);return(await i.json()).AWB_BASE_URL}return decodeURIComponent(o)})(),s=await(async()=>{const e=window.location.href,o=new URL(e).searchParams.get("sn_file_library_url");if(null===o){const e={method:"GET"},o=a.ServerConnection.makeSettings(),n=t(o)+"skillsnetwork-authoring-extension/config",i=await a.ServerConnection.makeRequest(n,e,o);return(await i.json()).SN_FILE_LIBRARY_URL}return decodeURIComponent(o)})(),r=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("mode");return"learn"==e?e:"author"},c=async()=>{const t=window.location.href,e=new URL(t).searchParams.get("atlas_token");return null!==e?e:"NO_TOKEN"},d=async()=>{const t=window.location.href,e=new URL(t).searchParams.get("awb_token");return null!==e?e:"NO_TOKEN"},u=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("env_type");return"jupyterlab"!==e&&"jupyterlite"!==e&&(e="local"),console.log("Env type: ",e),"jupyterlab"===e||"local"===e?(w.PY_KERNEL_NAME=await h(),w.DEFAULT_LAB_NAME="lab.ipynb"):"jupyterlite"===e&&(w.PY_KERNEL_NAME="python",w.DEFAULT_LAB_NAME="lab.jupyterlite.ipynb"),e},h=async()=>{let t=await(await a.KernelSpecAPI.getSpecs()).kernelspecs,e=Object.keys(t).filter((function(t){return t.includes("python")})).sort();return e[e.length-1]};class w{}w.TOKENS=new Map,w.SHOW_PUBLISH_BUTTON_FOR=void 0,n()}catch(t){n(t)}}),1)},6973:(t,e,o)=>{o.d(e,{Up:()=>l,YZ:()=>u,fP:()=>d,ql:()=>r,wW:()=>c,wj:()=>s});var n=o(8832),a=o(5777);class i extends n.Widget{constructor(){const t=document.createElement("div"),e=new a.Spinner;t.appendChild(e.node),t.style.padding="15px",super({node:t})}}const l=t=>{const e=new i;(0,a.showDialog)({title:t,body:e,buttons:[a.Dialog.cancelButton()]})},s=t=>{const e=new i;return(0,a.showDialog)({title:t,body:e,buttons:[]})},r=t=>(0,a.showDialog)({title:t,body:"Are you sure you want to publish? This action is not reversible",buttons:[a.Dialog.okButton(),a.Dialog.cancelButton()]}).then((t=>{if(!t.button.accept)throw new Error("Operation cancelled by the user.")})),c=()=>{(0,a.showDialog)({title:"Success!",body:"This lab has been successfully published!",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},d=()=>{(0,a.showDialog)({title:"Failed to Publish",body:"This lab failed to publish.",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},u=()=>{(0,a.showDialog)({title:"Failed to Load Lab",body:"This lab failed to load.",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))}},3311:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{B4:()=>y,RZ:()=>b,SJ:()=>h,So:()=>w,Wk:()=>p,nK:()=>g});var a=o(6973),i=o(5777),l=o(3619),s=o(9581),r=o.n(s),c=o(3191),d=o.n(c),u=t([l]);l=(u.then?(await u)():u)[0];const h=t=>r().create({baseURL:l.XM,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),w=t=>r().create({baseURL:l.DO,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),b=async(t,e)=>{try{const o=d()(e),n=o.version_id,a=o.lab_id,l=`${o.lab_name}.ipynb`,s=await t.get(`api/v1/labs/${a}/lab_versions/${n}/download`).then((t=>t.data));return i.Dialog.flush(),{labFilename:l,body:s}}catch(t){throw console.log(t),"Failed to fetch notebook"}},p=async(t,e,o)=>{if(!await(0,a.ql)("Publishing your lab onto Skills Network...").then((t=>!0)).catch((t=>!1)))return;(0,a.wj)("Publishing your changes...");const n=d()(o),l=n.version_id,s=n.lab_id;return new Promise((async(o,n)=>{await t.patch(`api/v1/labs/${s}/lab_versions/${l}/update_source_file`,{file:e}).then((t=>{console.log("SUCCESSFULLY PUSHED",t),i.Dialog.flush(),(0,a.wW)()})).catch((t=>{console.log(t),i.Dialog.flush(),(0,a.fP)()}))}))},y=t=>t.get("v1/labs").then((t=>(i.Dialog.flush(),t.data))).catch((t=>{throw console.log(t),"Failed to fetch notebook"})),g=async(t,e)=>{if(await(0,a.ql)("Publishing your lab onto Skills Network...").then((t=>!0)).catch((t=>!1)))return(0,a.wj)("Publishing your changes..."),new Promise((async(o,n)=>{await t.post("v1/labs",{body:e}).then((t=>{console.log("SUCCESSFULLY PUSHED",t),i.Dialog.flush(),(0,a.wW)()})).catch((t=>{console.log(t),i.Dialog.flush(),(0,a.fP)()}))}))};n()}catch(t){n(t)}}))},1568:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.r(e),o.d(e,{default:()=>s});var a=o(4822),i=o(7953),l=t([i,a]);[i,a]=l.then?(await l)():l;const s=[i.Z,a.G];n()}catch(t){n(t)}}))},4822:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{G:()=>p});var a=o(499),i=o(8832),l=o(5777),s=o(7423),r=o(6835),c=o(6973),d=o(3619),u=o(8623),h=o(3191),w=o.n(h),b=t([d,u]);[d,u]=b.then?(await b)():b;const p={id:"skillsnetwork-authoring-extension:menu",autoStart:!0,requires:[a.IMainMenu,s.INotebookTracker,r.IDocumentManager],activate:async(t,e,o,n)=>{if(console.log("Activated skillsnetwork-authoring-extension menu plugin!"),"learn"==await(0,d.IK)())return;const a="edit-lab-from-token";t.commands.addCommand(a,{label:"Edit a Lab",execute:()=>{h(o,n)}});const{commands:s}=t,r=new i.Menu({commands:s});r.title.label="Skills Network",e.addMenu(r,{rank:80}),r.addItem({command:a,args:{}});const h=(t,e)=>{let o=document.createElement("div"),n=document.createElement("label");n.textContent="Enter your authorization token";let a=document.createElement("input");a.className="jp-mod-styled",o.appendChild(n),o.appendChild(a),(0,l.showDialog)({title:"Edit a Lab",body:new i.Widget({node:o}),buttons:[l.Dialog.cancelButton(),l.Dialog.okButton()]}).then((async t=>{if(t.button.accept){(0,c.Up)("Loading up your lab...");const t=a.value;"version_id"in w()(t)?await(0,u.Ps)(t,e):await(0,u._Y)(t,e)}})).catch((t=>{l.Dialog.flush(),(0,c.YZ)(),console.log(t)}))}}};n()}catch(t){n(t)}}))},5449:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{E:()=>w});var a=o(8832),i=o(5777),l=o(3619),s=o(3191),r=o.n(s),c=t([l]);l=(c.then?(await c)():c)[0];var d,u=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class h extends a.Widget{constructor(t){const e=document.createElement("iframe"),o=l.OH.TOKENS.get(t);"project_id"in(o?r()(o):{})&&(e.src=`${l.CC}?atlas_token=${o}`),e.setAttribute("frameborder","0"),e.setAttribute("allow","clipboard-read; clipboard-write"),e.classList.add("sn-file-library-frame"),super({node:e})}}class w{constructor(t){d.set(this,void 0),function(t,e,o){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,o)}(this,d,t)}launch(){const t=new i.Dialog({title:"Skills Network File Library",body:new h(u(this,d)),hasClose:!0,buttons:[]}),e=t.node.querySelector(".jp-Dialog-content");e&&e.classList.add("sn-file-library-dialog"),t.launch()}}d=new WeakMap,n()}catch(t){n(t)}}))},8623:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{Ps:()=>c,_Y:()=>d,nu:()=>r});var a=o(3619),i=o(3311),l=t([i,a]);[i,a]=l.then?(await l)():l;const s=t=>({cell_type:t.model.type,id:t.model.id,metadata:{},outputs:[],source:[t.model.value.text]}),r=(t,e)=>{const o=[];t.content.widgets.forEach((t=>{const e=s(t);o.push(e)}));const n=e.model.metadata.toJSON(),a=e.model.nbformat,i=e.model.nbformatMinor,l={cells:o,metadata:n,nbformat:a,nbformat_minor:i};return JSON.stringify(l,null,2)},c=async(t,e)=>{let{labFilename:o,body:n}=await(0,i.RZ)((0,i.So)(t),t);a.OH.SHOW_PUBLISH_BUTTON_FOR=o;const l=e.createNew(o,"notebook",{name:a.OH.PY_KERNEL_NAME});if(a.OH.SHOW_PUBLISH_BUTTON_FOR=void 0,a.OH.TOKENS.set(l.id,t),void 0===l)throw Error("Error loading lab");return await u(l,n),l},d=async(t,e)=>{let{instructions_file_path:o,body:n}=await(0,i.B4)((0,i.SJ)(t));const l=h(o);a.OH.SHOW_PUBLISH_BUTTON_FOR=l;const s=e.createNew(l,"notebook",{name:a.OH.PY_KERNEL_NAME});if(a.OH.SHOW_PUBLISH_BUTTON_FOR=void 0,a.OH.TOKENS.set(s.id,t),void 0===s)throw Error("Error loading lab");return await u(s,JSON.parse(n)),s},u=async(t,e,o)=>{await t.context.ready,"local"!==o&&(t.context&&t.context.model?t.context.model.fromJSON(e):console.error("Notebook model is not initialized."))},h=t=>(null!=t?t:a.OH.DEFAULT_LAB_NAME).replace(/^.*[\\\/]/,"");n()}catch(t){n(t)}}))}}]);