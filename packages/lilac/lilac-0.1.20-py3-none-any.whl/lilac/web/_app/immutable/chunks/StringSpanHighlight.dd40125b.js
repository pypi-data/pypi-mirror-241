import{S as $,i as ee,s as te,D as I,Z as F,_ as U,m as b,h as d,n as E,$ as K,b as S,a0 as p,K as me,a1 as T,M as j,Q as X,q as z,r as M,u as q,k as H,y as le,l as P,z as ie,F as R,A as ne,a7 as de,W as ft,g as y,d as N,B as se,a as Q,c as Z,v as J,f as x,a2 as Je,a3 as He,N as dt,G as he,L as xe,X as $e,Y as ht,p as W,ah as mt,ao as gt,a4 as _t,O as we,ai as pt,e as Pe,a8 as Be}from"./index.c820bada.js";import{ay as Ve,d as bt,h as et,N as vt,_ as Ee,X as tt,a9 as lt,ak as kt,aj as oe,a2 as ye,g as wt,b3 as Et,am as yt,b7 as St,av as Nt,bx as Ct,B as it,bp as Ht}from"./Commands.c9751f2c.js";import{f as Le,g as Pt}from"./notificationsStore.315ab01e.js";import{c as Se,L as Te,a as ze}from"./colors.f6cbcb11.js";function Me(i){let e,l;return{c(){e=F("title"),l=z(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=M(s,i[1]),s.forEach(d)},m(t,s){S(t,e,s),p(e,l)},p(t,s){s&2&&q(l,t[1])},d(t){t&&d(e)}}}function Bt(i){let e,l,t=i[1]&&Me(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=I(c,s[n]);return{c(){e=F("svg"),t&&t.c(),l=F("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M24.59 16.59L17 24.17 17 4 15 4 15 24.17 7.41 16.59 6 18 16 28 26 18 24.59 16.59z"),K(e,c)},m(n,a){S(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Me(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:T,o:T,d(n){n&&d(e),t&&t.d()}}}function Vt(i,e,l){let t,s;const c=["size","title"];let n=j(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=I(I({},e),X(o))),l(3,n=j(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=X(e),[a,r,s,n,t]}class Lt extends ${constructor(e){super(),ee(this,e,Vt,Bt,te,{size:0,title:1})}}function Ie(i){let e,l;return{c(){e=F("title"),l=z(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=M(s,i[1]),s.forEach(d)},m(t,s){S(t,e,s),p(e,l)},p(t,s){s&2&&q(l,t[1])},d(t){t&&d(e)}}}function Tt(i){let e,l,t=i[1]&&Ie(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=I(c,s[n]);return{c(){e=F("svg"),t&&t.c(),l=F("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M16 4L6 14 7.41 15.41 15 7.83 15 28 17 28 17 7.83 24.59 15.41 26 14 16 4z"),K(e,c)},m(n,a){S(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Ie(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:T,o:T,d(n){n&&d(e),t&&t.d()}}}function zt(i,e,l){let t,s;const c=["size","title"];let n=j(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=I(I({},e),X(o))),l(3,n=j(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=X(e),[a,r,s,n,t]}class Mt extends ${constructor(e){super(),ee(this,e,zt,Tt,te,{size:0,title:1})}}function Ae(i){let e,l;return{c(){e=F("title"),l=z(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=M(s,i[1]),s.forEach(d)},m(t,s){S(t,e,s),p(e,l)},p(t,s){s&2&&q(l,t[1])},d(t){t&&d(e)}}}function It(i){let e,l,t=i[1]&&Ae(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=I(c,s[n]);return{c(){e=F("svg"),t&&t.c(),l=F("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"),K(e,c)},m(n,a){S(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Ae(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:T,o:T,d(n){n&&d(e),t&&t.d()}}}function At(i,e,l){let t,s;const c=["size","title"];let n=j(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=I(I({},e),X(o))),l(3,n=j(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=X(e),[a,r,s,n,t]}class Rt extends ${constructor(e){super(),ee(this,e,At,It,te,{size:0,title:1})}}function Re(i){let e,l;return{c(){e=F("title"),l=z(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=M(s,i[1]),s.forEach(d)},m(t,s){S(t,e,s),p(e,l)},p(t,s){s&2&&q(l,t[1])},d(t){t&&d(e)}}}function Dt(i){let e,l,t=i[1]&&Re(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=I(c,s[n]);return{c(){e=F("svg"),t&&t.c(),l=F("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"),K(e,c)},m(n,a){S(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Re(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:T,o:T,d(n){n&&d(e),t&&t.d()}}}function Ot(i,e,l){let t,s;const c=["size","title"];let n=j(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=I(I({},e),X(o))),l(3,n=j(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=X(e),[a,r,s,n,t]}class Ft extends ${constructor(e){super(),ee(this,e,Ot,Dt,te,{size:0,title:1})}}function Ut(i,e){const l=t=>i&&!i.contains(t.target)&&!t.defaultPrevented&&e();return document.addEventListener("click",l,!0),{destroy(){document.removeEventListener("click",l,!0)}}}function Yt(i){let e=(i[1]?"":i[0])+"",l;return{c(){l=z(e)},l(t){l=M(t,e)},m(t,s){S(t,l,s)},p(t,s){s&3&&e!==(e=(t[1]?"":t[0])+"")&&q(l,e)},d(t){t&&d(l)}}}function jt(i){let e,l,t,s,c;const n=[i[2],{type:"purple"},{icon:Ve}];let a={$$slots:{default:[Yt]},$$scope:{ctx:i}};for(let r=0;r<n.length;r+=1)a=I(a,n[r]);return l=new bt({props:a}),{c(){e=H("div"),le(l.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var o=b(e);ie(l.$$.fragment,o),o.forEach(d),this.h()},h(){E(e,"class","embedding-badge truncate"),R(e,"embedding-badge-nolabel",i[1])},m(r,o){S(r,e,o),ne(l,e,null),t=!0,s||(c=de(et.call(null,e,{text:"Embedding index"})),s=!0)},p(r,[o]){const u=o&4?me(n,[o&4&&ft(r[2]),n[1],o&0&&{icon:Ve}]):{};o&11&&(u.$$scope={dirty:o,ctx:r}),l.$set(u),(!t||o&2)&&R(e,"embedding-badge-nolabel",r[1])},i(r){t||(y(l.$$.fragment,r),t=!0)},o(r){N(l.$$.fragment,r),t=!1},d(r){r&&d(e),se(l),s=!1,c()}}}function qt(i,e,l){const t=["embedding","hideEmbeddingName"];let s=j(e,t),{embedding:c}=e,{hideEmbeddingName:n=!1}=e;return i.$$set=a=>{e=I(I({},e),X(a)),l(2,s=j(e,t)),"embedding"in a&&l(0,c=a.embedding),"hideEmbeddingName"in a&&l(1,n=a.hideEmbeddingName)},[c,n,s]}class Wt extends ${constructor(e){super(),ee(this,e,qt,jt,te,{embedding:0,hideEmbeddingName:1})}}function De(i,e,l){const t=i.slice();return t[12]=e[l],t}function Oe(i){let e,l,t=i[0].conceptNamespace+"",s,c,n=i[0].conceptName+"",a,r,o,u,f,m,g,v,_,k,w;return f=new Ft({}),v=new Rt({}),{c(){e=H("div"),l=H("div"),s=z(t),c=z(" / "),a=z(n),r=Q(),o=H("div"),u=H("button"),le(f.$$.fragment),m=Q(),g=H("button"),le(v.$$.fragment),this.h()},l(C){e=P(C,"DIV",{class:!0});var V=b(e);l=P(V,"DIV",{class:!0});var O=b(l);s=M(O,t),c=M(O," / "),a=M(O,n),O.forEach(d),r=Z(V),o=P(V,"DIV",{class:!0});var Y=b(o);u=P(Y,"BUTTON",{class:!0});var L=b(u);ie(f.$$.fragment,L),L.forEach(d),m=Z(Y),g=P(Y,"BUTTON",{class:!0});var A=b(g);ie(v.$$.fragment,A),A.forEach(d),Y.forEach(d),V.forEach(d),this.h()},h(){E(l,"class","flex-grow"),E(u,"class","p-1"),E(g,"class","p-1"),E(o,"class","shrink-0"),E(e,"class","flex flex-row items-center justify-between gap-x-4 p-2")},m(C,V){S(C,e,V),p(e,l),p(l,s),p(l,c),p(l,a),p(e,r),p(e,o),p(o,u),ne(f,u,null),p(o,m),p(o,g),ne(v,g,null),_=!0,k||(w=[he(u,"click",i[8]),he(g,"click",i[9])],k=!0)},p(C,V){(!_||V&1)&&t!==(t=C[0].conceptNamespace+"")&&q(s,t),(!_||V&1)&&n!==(n=C[0].conceptName+"")&&q(a,n)},i(C){_||(y(f.$$.fragment,C),y(v.$$.fragment,C),_=!0)},o(C){N(f.$$.fragment,C),N(v.$$.fragment,C),_=!1},d(C){C&&d(e),se(f),se(v),k=!1,xe(w)}}}function Fe(i){let e,l=[],t=new Map,s,c=i[2];const n=a=>a[12];for(let a=0;a<c.length;a+=1){let r=De(i,c,a),o=n(r);t.set(o,l[a]=Ue(o,r))}return{c(){e=H("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=P(a,"DIV",{class:!0});var r=b(e);for(let o=0;o<l.length;o+=1)l[o].l(r);r.forEach(d),this.h()},h(){E(e,"class","more-button flex flex-col")},m(a,r){S(a,e,r);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null);s=!0},p(a,r){r&29&&(c=a[2],J(),l=$e(l,r,n,1,a,c,t,e,ht,Ue,null,De),x())},i(a){if(!s){for(let r=0;r<c.length;r+=1)y(l[r]);s=!0}},o(a){for(let r=0;r<l.length;r+=1)N(l[r]);s=!1},d(a){a&&d(e);for(let r=0;r<l.length;r+=1)l[r].d()}}}function Ue(i,e){let l,t,s,c,n,a,r,o,u;n=new Wt({props:{class:"hover:cursor-pointer",embedding:e[12]}});function f(){return e[10](e[12])}return{key:i,first:null,c(){l=H("button"),t=H("div"),s=z("Find similar"),c=Q(),le(n.$$.fragment),a=Q(),this.h()},l(m){l=P(m,"BUTTON",{class:!0});var g=b(l);t=P(g,"DIV",{});var v=b(t);s=M(v,"Find similar"),v.forEach(d),c=Z(g),ie(n.$$.fragment,g),a=Z(g),g.forEach(d),this.h()},h(){E(l,"class","flex w-full items-center justify-between"),this.first=l},m(m,g){S(m,l,g),p(l,t),p(t,s),p(l,c),ne(n,l,null),p(l,a),r=!0,o||(u=he(l,"click",f),o=!0)},p(m,g){e=m;const v={};g&4&&(v.embedding=e[12]),n.$set(v)},i(m){r||(y(n.$$.fragment,m),r=!0)},o(m){N(n.$$.fragment,m),r=!1},d(m){m&&d(l),se(n),o=!1,u()}}}function Xt(i){let e,l,t,s,c,n,a,r=i[0].conceptName!=null&&i[0].conceptNamespace!=null&&Oe(i),o=i[3]!=null&&Fe(i);return{c(){e=H("div"),r&&r.c(),l=Q(),o&&o.c(),this.h()},l(u){e=P(u,"DIV",{style:!0,class:!0});var f=b(e);r&&r.l(f),l=Z(f),o&&o.l(f),f.forEach(d),this.h()},h(){E(e,"style",t=i[1]!=null?`left: ${i[1].x}px; top: ${i[1].y}px`:""),E(e,"class","absolute z-10 inline-flex -translate-x-1/2 translate-y-6 flex-col divide-y divide-gray-200 rounded border border-gray-200 bg-white shadow")},m(u,f){S(u,e,f),r&&r.m(e,null),p(e,l),o&&o.m(e,null),c=!0,n||(a=de(Ut.call(null,e,i[11])),n=!0)},p(u,[f]){u[0].conceptName!=null&&u[0].conceptNamespace!=null?r?(r.p(u,f),f&1&&y(r,1)):(r=Oe(u),r.c(),y(r,1),r.m(e,l)):r&&(J(),N(r,1,1,()=>{r=null}),x()),u[3]!=null?o?(o.p(u,f),f&8&&y(o,1)):(o=Fe(u),o.c(),y(o,1),o.m(e,null)):o&&(J(),N(o,1,1,()=>{o=null}),x()),(!c||f&2&&t!==(t=u[1]!=null?`left: ${u[1].x}px; top: ${u[1].y}px`:""))&&E(e,"style",t)},i(u){c||(y(r),y(o),Je(()=>{c&&(s||(s=He(e,Le,{duration:60},!0)),s.run(1))}),c=!0)},o(u){N(r),N(o),s||(s=He(e,Le,{duration:60},!1)),s.run(0),c=!1},d(u){u&&d(e),r&&r.d(),o&&o.d(),u&&s&&s.end(),n=!1,a()}}}function Gt(i,e,l){let{details:t}=e,{clickPosition:s}=e,{embeddings:c}=e,{addConceptLabel:n}=e,{findSimilar:a}=e,{addNotification:r}=e;const o=dt();function u(_){if(!t.conceptName||!t.conceptNamespace)throw Error("Label could not be added, no active concept.");n(t.conceptNamespace,t.conceptName,t.text,_),r({kind:"success",title:`[${_===!0?"Positive":"Negative"}] Concept label added`,subtitle:vt(t.conceptNamespace,t.conceptName),message:t.text}),o("click")}const f=()=>u(!0),m=()=>u(!1),g=_=>{a&&a(_,t.text),o("click")},v=()=>o("close");return i.$$set=_=>{"details"in _&&l(0,t=_.details),"clickPosition"in _&&l(1,s=_.clickPosition),"embeddings"in _&&l(2,c=_.embeddings),"addConceptLabel"in _&&l(6,n=_.addConceptLabel),"findSimilar"in _&&l(3,a=_.findSimilar),"addNotification"in _&&l(7,r=_.addNotification)},[t,s,c,a,o,u,n,r,f,m,g,v]}class Kt extends ${constructor(e){super(),ee(this,e,Gt,Xt,te,{details:0,clickPosition:1,embeddings:2,addConceptLabel:6,findSimilar:3,addNotification:7})}}function Qt(i,e){let l,t=e;i.addEventListener("click",n=>s(n));function s(n){t.disabled||(l=new Kt({props:{details:t.details(),clickPosition:{x:n.clientX,y:n.clientY},embeddings:t.embeddings,addConceptLabel:t.addConceptLabel,addNotification:t.addNotification,findSimilar:t.findSimilar},target:document.body}),l.$on("close",c),l.$on("click",c))}function c(){l==null||l.$destroy(),l=void 0}return{update(n){t=n,l==null||l.$set({details:t.details()})},destroy(){c()}}}function Ye(i,e,l){const t=i.slice();return t[7]=e[l],t}function je(i,e){let l,t,s=e[7].info.name+"",c,n,a,r,o=qe(e[7])+"",u,f;return{key:i,first:null,c(){l=H("div"),t=H("div"),c=z(s),n=Q(),a=H("div"),r=H("span"),u=z(o),f=Q(),this.h()},l(m){l=P(m,"DIV",{class:!0});var g=b(l);t=P(g,"DIV",{class:!0});var v=b(t);c=M(v,s),v.forEach(d),n=Z(g),a=P(g,"DIV",{class:!0});var _=b(a);r=P(_,"SPAN",{class:!0});var k=b(r);u=M(k,o),k.forEach(d),_.forEach(d),f=Z(g),g.forEach(d),this.h()},h(){E(t,"class","named-value-name table-cell max-w-xs truncate pr-2 svelte-1689hje"),E(r,"class","px-1"),R(r,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Ee(e[7].info.dtype)),W(r,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Se(e[7].value):""),E(a,"class","table-cell rounded text-right"),E(l,"class","table-row"),this.first=l},m(m,g){S(m,l,g),p(l,t),p(t,c),p(l,n),p(l,a),p(a,r),p(r,u),p(l,f)},p(m,g){e=m,g&1&&s!==(s=e[7].info.name+"")&&q(c,s),g&1&&o!==(o=qe(e[7])+"")&&q(u,o),g&1&&R(r,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Ee(e[7].info.dtype)),g&1&&W(r,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Se(e[7].value):"")},d(m){m&&d(l)}}}function Zt(i){let e,l,t=[],s=new Map,c,n=`${i[4]}px`,a=`${Math.min(i[1],i[3]-i[2]-20)}px`,r=i[0];const o=u=>u[7];for(let u=0;u<r.length;u+=1){let f=Ye(i,r,u),m=o(f);s.set(m,t[u]=je(m,f))}return{c(){e=H("div"),l=H("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=P(u,"DIV",{role:!0,class:!0});var f=b(e);l=P(f,"DIV",{class:!0});var m=b(l);for(let g=0;g<t.length;g+=1)t[g].l(m);m.forEach(d),f.forEach(d),this.h()},h(){E(l,"class","table border-spacing-y-2"),E(e,"role","tooltip"),E(e,"class","absolute max-w-fit -translate-y-full break-words border border-gray-300 bg-white px-2 shadow-md"),Je(()=>i[6].call(e)),R(e,"hidden",i[0].length===0),W(e,"top",n),W(e,"left",a)},m(u,f){S(u,e,f),p(e,l);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(l,null);c=mt(e,i[6].bind(e))},p(u,[f]){f&1&&(r=u[0],t=$e(t,f,o,1,u,r,s,l,gt,je,null,Ye)),f&1&&R(e,"hidden",u[0].length===0),f&6&&a!==(a=`${Math.min(u[1],u[3]-u[2]-20)}px`)&&W(e,"left",a)},i:T,o:T,d(u){u&&d(e);for(let f=0;f<t.length;f+=1)t[f].d();c()}}}function qe(i){return typeof i.value=="number"?i.value.toFixed(3):i.info.dtype==="string_span"?"true":i.value}function Jt(i,e,l){let{namedValues:t}=e,{x:s}=e,{y:c}=e;const n=window.innerWidth;let a=0;const r=c-1;function o(){a=this.clientWidth,l(2,a)}return i.$$set=u=>{"namedValues"in u&&l(0,t=u.namedValues),"x"in u&&l(1,s=u.x),"y"in u&&l(5,c=u.y)},[t,s,a,n,r,c,o]}class xt extends ${constructor(e){super(),ee(this,e,Jt,Zt,te,{namedValues:0,x:1,y:5})}}function $t(i,e){let l,t=e;const s=()=>n();t.isHovered&&c();function c(){const a=t.namedValues.filter(m=>Array.from(t.spansHovered).some(g=>{const v=tt(g);return lt(m.specificPath.slice(0,v.length),v)}));t.itemScrollContainer!=null&&t.itemScrollContainer.addEventListener("scroll",s);const r=i.getBoundingClientRect(),o=window.getComputedStyle(i),u=parseInt(o.getPropertyValue("line-height")),f=r.height>u?r.x+i.offsetLeft||i.clientLeft:r.x;l=new xt({props:{namedValues:a,x:f,y:r.top},target:document.body})}function n(){var a;l==null||l.$destroy(),(a=t.itemScrollContainer)==null||a.removeEventListener("scroll",s)}return{update(a){n(),t=a,t.isHovered&&c()},destroy(){n()}}}const We=300,ve=50;function el(i,e,l){const t=[],s=new Set;for(const c of i){let n=!1;const a=[];for(const w of c.paths)s.has(w)||(a.push(w),s.add(w));const r=[],o=[];let u=-1/0;for(const[w,C]of Object.entries(c.originalSpans)){const V=e[w],O=tt(w);if(!(V==null||V.length===0))for(const Y of C)for(const L of V){const A=L.path.slice(O.length),D=kt(Y,A);if(D==null)continue;const ae=oe.value(D),ge=oe.span(D);if(ae==null&&ge==null)continue;if(L.dtype==="float32"){const pe=oe.value(D);pe!=null&&(u=Math.max(u,pe))}const G=ye(oe.path(Y)),_e=!a.includes(G),re={value:ae,info:L,specificPath:oe.path(D)};_e||r.push(re),o.push(re),L.type==="concept_score"||L.type==="semantic_similarity"?ae>.5&&(n=!0):n=!0}}const f=o.some(w=>w.info.type==="label"),m=o.some(w=>w.info.type==="leaf_span"),g=o.some(w=>w.info.type==="keyword"),v=o.some(w=>w.info.type==="metadata"&&!Ee(w.info.dtype)),_=c.paths.some(w=>l.has(w)),k=_&&a.length>0&&Array.from(l).some(w=>a.includes(w));t.push({backgroundColor:Se(u),isBlackBolded:g||v||m,isHighlightBolded:f,isHighlighted:n,snippetScore:u,namedValues:r,paths:c.paths,text:c.text,originalSpans:c.originalSpans,isHovered:_,isFirstHover:k})}return t}function tl(i,e){var c;let l=!1,t=!1,s=[];for(let n=0;n<i.length;n++){const a=i[n],r=n-1>=0?i[n-1]:null,o=n+1<i.length?i[n+1]:null,u=(c=s.at(-1))==null?void 0:c.isEllipsis;if(!a.isHighlighted){if(u||r!=null&&r.isHighlighted||o!=null&&o.isHighlighted)continue;l=!0,s.push({isEllipsis:!0});continue}t=!0,r!=null&&!r.isHighlighted&&(!u&&r.text.length>ve&&(s.push({isEllipsis:!0}),l=!0),s.push({renderSpan:r,snippetText:r.text.slice(-ve)})),s.push({renderSpan:a,snippetText:a.text}),o!=null&&!o.isHighlighted&&(s.push({renderSpan:o,snippetText:o.text.slice(0,ve)}),!u&&o.text.length>ve&&(s.push({isEllipsis:!0}),l=!0))}return t||(s=[],l=!1,s.push({renderSpan:i[0],snippetText:i[0].text.slice(0,We)}),((i[1]||null)!=null||i[0].text.length>We)&&(s.push({isEllipsis:!0}),l=!0)),e&&(s=i.map(n=>({renderSpan:n,snippetText:n.text}))),{snippetSpans:s,textIsOverBudget:l}}function Xe(i,e,l){const t=i.slice();return t[36]=e[l],t}function ll(i){const e=i.slice(),l=e[36].renderSpan;return e[39]=l,e}function il(i){let e,l,t,s;return{c(){e=H("span"),l=z("..."),this.h()},l(c){e=P(c,"SPAN",{class:!0});var n=b(e);l=M(n,"..."),n.forEach(d),this.h()},h(){E(e,"class","highlight-span text-sm leading-5 svelte-10l1gaq")},m(c,n){S(c,e,n),p(e,l),t||(s=de(et.call(null,e,{text:`Some text was hidden to improve readability. 
Click "Show all" to show the entire document.`})),t=!0)},p:T,i:T,o:T,d(c){c&&d(e),t=!1,s()}}}function nl(i){let e,l,t,s,c,n,a,r;const o=[al,sl],u=[];function f(_,k){return _[1]?0:1}l=f(i),t=u[l]=o[l](i);function m(){return i[30](i[39])}function g(){return i[31](i[39])}function v(){return i[32](i[39])}return{c(){e=H("span"),t.c(),this.h()},l(_){e=P(_,"SPAN",{class:!0});var k=b(e);t.l(k),k.forEach(d),this.h()},h(){E(e,"class","hover:cursor-poiner highlight-span break-words text-sm leading-5 svelte-10l1gaq"),R(e,"highlighted",i[39].isHighlighted),R(e,"hover:cursor-pointer",i[0].length>0),R(e,"font-bold",i[39].isBlackBolded),R(e,"font-medium",i[39].isHighlightBolded&&!i[39].isBlackBolded),W(e,"color",i[39].isHighlightBolded&&!i[39].isBlackBolded?Te:""),W(e,"background-color",i[39].isHovered?ze(Qe):i[39].backgroundColor)},m(_,k){S(_,e,k),u[l].m(e,null),n=!0,a||(r=[de(s=$t.call(null,e,{namedValues:i[39].namedValues,isHovered:i[39].isFirstHover,spansHovered:i[5],itemScrollContainer:i[8]})),de(c=Qt.call(null,e,{details:m,findSimilar:i[9].page==="datasets"?i[17]:null,embeddings:i[2],addConceptLabel:i[15],addNotification:i[18]!=null?i[18].addNotification:Ze,disabled:i[39].paths.length===0||i[2].length===0})),he(e,"mouseenter",g),he(e,"mouseleave",v)],a=!0)},p(_,k){i=_;let w=l;l=f(i),l===w?u[l].p(i,k):(J(),N(u[w],1,1,()=>{u[w]=null}),x(),t=u[l],t?t.p(i,k):(t=u[l]=o[l](i),t.c()),y(t,1),t.m(e,null)),s&&Be(s.update)&&k[0]&416&&s.update.call(null,{namedValues:i[39].namedValues,isHovered:i[39].isFirstHover,spansHovered:i[5],itemScrollContainer:i[8]}),c&&Be(c.update)&&k[0]&644&&c.update.call(null,{details:m,findSimilar:i[9].page==="datasets"?i[17]:null,embeddings:i[2],addConceptLabel:i[15],addNotification:i[18]!=null?i[18].addNotification:Ze,disabled:i[39].paths.length===0||i[2].length===0}),(!n||k[0]&128)&&R(e,"highlighted",i[39].isHighlighted),(!n||k[0]&1)&&R(e,"hover:cursor-pointer",i[0].length>0),(!n||k[0]&128)&&R(e,"font-bold",i[39].isBlackBolded),(!n||k[0]&128)&&R(e,"font-medium",i[39].isHighlightBolded&&!i[39].isBlackBolded),k[0]&128&&W(e,"color",i[39].isHighlightBolded&&!i[39].isBlackBolded?Te:""),k[0]&128&&W(e,"background-color",i[39].isHovered?ze(Qe):i[39].backgroundColor)},i(_){n||(y(t),n=!0)},o(_){N(t),n=!1},d(_){_&&d(e),u[l].d(),a=!1,xe(r)}}}function sl(i){let e=i[36].snippetText+"",l;return{c(){l=z(e)},l(t){l=M(t,e)},m(t,s){S(t,l,s)},p(t,s){s[0]&128&&e!==(e=t[36].snippetText+"")&&q(l,e)},i:T,o:T,d(t){t&&d(l)}}}function al(i){let e,l;return e=new Ht({props:{source:i[36].snippetText}}),{c(){le(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const c={};s[0]&128&&(c.source=t[36].snippetText),e.$set(c)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function Ge(i){let e,l,t,s;const c=[nl,il],n=[];function a(o,u){return o[36].isEllipsis?1:0}function r(o,u){return u===0?ll(o):o}return e=a(i),l=n[e]=c[e](r(i,e)),{c(){l.c(),t=Pe()},l(o){l.l(o),t=Pe()},m(o,u){n[e].m(o,u),S(o,t,u),s=!0},p(o,u){let f=e;e=a(o),e===f?n[e].p(r(o,e),u):(J(),N(n[f],1,1,()=>{n[f]=null}),x(),l=n[e],l?l.p(r(o,e),u):(l=n[e]=c[e](r(o,e)),l.c()),y(l,1),l.m(t.parentNode,t))},i(o){s||(y(l),s=!0)},o(o){N(l),s=!1},d(o){n[e].d(o),o&&d(t)}}}function Ke(i){let e,l,t,s,c;const n=[rl,ol],a=[];function r(o,u){return o[4]?1:0}return t=r(i),s=a[t]=n[t](i),{c(){e=H("div"),l=H("div"),s.c(),this.h()},l(o){e=P(o,"DIV",{class:!0});var u=b(e);l=P(u,"DIV",{class:!0});var f=b(l);s.l(f),f.forEach(d),u.forEach(d),this.h()},h(){E(l,"class","w-30 mt-2 rounded border border-neutral-300 text-center"),E(e,"class","flex flex-row justify-center")},m(o,u){S(o,e,u),p(e,l),a[t].m(l,null),c=!0},p(o,u){let f=t;t=r(o),t===f?a[t].p(o,u):(J(),N(a[f],1,1,()=>{a[f]=null}),x(),s=a[t],s?s.p(o,u):(s=a[t]=n[t](o),s.c()),y(s,1),s.m(l,null))},i(o){c||(y(s),c=!0)},o(o){N(s),c=!1},d(o){o&&d(e),a[t].d()}}}function ol(i){let e,l;return e=new it({props:{size:"small",class:"w-full",kind:"ghost",icon:Mt,$$slots:{default:[cl]},$$scope:{ctx:i}}}),e.$on("click",i[34]),{c(){le(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const c={};s[1]&512&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function rl(i){let e,l;return e=new it({props:{size:"small",class:"w-full",kind:"ghost",icon:Lt,$$slots:{default:[ul]},$$scope:{ctx:i}}}),e.$on("click",i[33]),{c(){le(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const c={};s[1]&512&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function cl(i){let e;return{c(){e=z("Hide excess")},l(l){e=M(l,"Hide excess")},m(l,t){S(l,e,t)},d(l){l&&d(e)}}}function ul(i){let e;return{c(){e=z("Show all")},l(l){e=M(l,"Show all")},m(l,t){S(l,e,t)},d(l){l&&d(e)}}}function fl(i){let e,l,t,s=i[7],c=[];for(let r=0;r<s.length;r+=1)c[r]=Ge(Xe(i,s,r));const n=r=>N(c[r],1,1,()=>{c[r]=null});let a=i[6]&&!i[3]&&Ke(i);return{c(){e=H("div");for(let r=0;r<c.length;r+=1)c[r].c();l=Q(),a&&a.c(),this.h()},l(r){e=P(r,"DIV",{class:!0});var o=b(e);for(let u=0;u<c.length;u+=1)c[u].l(o);l=Z(o),a&&a.l(o),o.forEach(d),this.h()},h(){E(e,"class","relative overflow-x-hidden text-ellipsis whitespace-break-spaces")},m(r,o){S(r,e,o);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(e,null);p(e,l),a&&a.m(e,null),t=!0},p(r,o){if(o[0]&441255){s=r[7];let u;for(u=0;u<s.length;u+=1){const f=Xe(r,s,u);c[u]?(c[u].p(f,o),y(c[u],1)):(c[u]=Ge(f),c[u].c(),y(c[u],1),c[u].m(e,l))}for(J(),u=s.length;u<c.length;u+=1)n(u);x()}r[6]&&!r[3]?a?(a.p(r,o),o[0]&72&&y(a,1)):(a=Ke(r),a.c(),y(a,1),a.m(e,null)):a&&(J(),N(a,1,1,()=>{a=null}),x())},i(r){if(!t){for(let o=0;o<s.length;o+=1)y(c[o]);y(a),t=!0}},o(r){c=c.filter(Boolean);for(let o=0;o<c.length;o+=1)N(c[o]);N(a),t=!1},d(r){r&&d(e),_t(c,r),a&&a.d()}}}const Qe=.9,Ze=()=>null;function dl(i,e,l){let t,s,c,n,a,r,o,{text:u}=e,{row:f}=e,{field:m=void 0}=e,{spanPaths:g}=e,{path:v=void 0}=e,{valuePaths:_}=e,{markdown:k=!1}=e,{embeddings:w}=e,{datasetViewStore:C=void 0}=e,{alwaysExpand:V=!1}=e,O=V;const Y=wt();we(i,Y,h=>l(9,o=h));let L,A={},D=new Set;const ae=h=>{h.paths.forEach(B=>D.add(B)),l(5,D)},ge=h=>{h.paths.forEach(B=>D.delete(B)),l(5,D)};let G={};const _e=h=>{const ce={conceptName:null,conceptNamespace:null,text:s.filter(ue=>ue.paths.some(ke=>((h==null?void 0:h.paths)||[]).some(fe=>lt(fe,ke)))).map(ue=>ue.text).join("")};for(const ue of Object.keys(h.originalSpans)){const ke=(A[ue]||[]).filter(fe=>fe.type==="concept_score");for(const fe of ke){const Ce=fe.signal;ce.conceptName=Ce.concept_name,ce.conceptNamespace=Ce.namespace;break}}return ce},re=Et();we(i,re,h=>l(35,a=h));const pe=(h,B,be,ce)=>{if(!B||!h)throw Error("Label could not be added, no active concept.");a.mutate([h,B,{insert:[{text:be,label:ce}]}])};let Ne=pt(yt);we(i,Ne,h=>l(8,r=h));const nt=(h,B)=>{C==null||m==null||C.addSearch({path:m.path,type:"semantic",query_type:"document",query:B,embedding:h})},st=Pt(),at=h=>_e(h),ot=h=>ae(h),rt=h=>ge(h),ct=()=>l(4,O=!0),ut=()=>l(4,O=!1);return i.$$set=h=>{"text"in h&&l(19,u=h.text),"row"in h&&l(20,f=h.row),"field"in h&&l(21,m=h.field),"spanPaths"in h&&l(0,g=h.spanPaths),"path"in h&&l(22,v=h.path),"valuePaths"in h&&l(23,_=h.valuePaths),"markdown"in h&&l(1,k=h.markdown),"embeddings"in h&&l(2,w=h.embeddings),"datasetViewStore"in h&&l(24,C=h.datasetViewStore),"alwaysExpand"in h&&l(3,V=h.alwaysExpand)},i.$$.update=()=>{if(i.$$.dirty[0]&5242881&&(l(25,L={}),g.forEach(h=>{const B=St(f,h);l(25,L[ye(h)]=B.filter(be=>Nt(oe.path(be),v)||v==null),L)})),i.$$.dirty[0]&75497472){l(26,A={});for(const h of _){const B=ye(h.spanPath);A[B]==null&&l(26,A[B]=[],A),A[B].push(h)}}if(i.$$.dirty[0]&34078720&&l(29,t=Ct(u,L)),i.$$.dirty[0]&603979808&&l(28,s=el(t,A,D)),i.$$.dirty[0]&671088640){l(27,G={});for(const h of t)for(const B of h.paths)l(27,G[B]=G[B]||[],G),G[B].push(h)}i.$$.dirty[0]&268435472&&l(7,{snippetSpans:c,textIsOverBudget:n}=tl(s,O),c,(l(6,n),l(28,s),l(4,O),l(29,t),l(26,A),l(5,D),l(19,u),l(25,L),l(23,_),l(0,g),l(20,f),l(22,v)))},[g,k,w,V,O,D,n,c,r,o,Y,ae,ge,_e,re,pe,Ne,nt,st,u,f,m,v,_,C,L,A,G,s,t,at,ot,rt,ct,ut]}class pl extends ${constructor(e){super(),ee(this,e,dl,fl,te,{text:19,row:20,field:21,spanPaths:0,path:22,valuePaths:23,markdown:1,embeddings:2,datasetViewStore:24,alwaysExpand:3},null,[-1,-1])}}export{Mt as A,Wt as E,pl as S,Ft as T,Rt as a,Lt as b,Ut as c};
